<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제5장 DBMS_AQ</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero tbPSM 참조 안내서"/><link rel="up" href="index.html" title="Tibero tbPSM 참조 안내서"/><link rel="prev" href="chap_dbms_application_info.html" title="제4장 DBMS_APPLICATION_INFO"/><link rel="next" href="chap_dbms_aqadm.html" title="제6장 DBMS_AQADM"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제5장 DBMS_AQ</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap_dbms_application_info.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="chap_dbms_aqadm.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chap_dbms_aq"/>제5장 DBMS_AQ</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chap_dbms_aq.html#d5e1406">5.1. 개요</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#sect_dbms_aq_type">5.2. 타입</a></span></dt><dd><dl><dt><span class="section"><a href="chap_dbms_aq.html#d5e1433">5.2.1. AQ$_AGENT</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#d5e1466">5.2.2. AQ$_RECIPIENT_LIST_T</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE_OPTIONS_T">5.2.3. DEQUEUE_OPTIONS_T</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_ENQUEUE_OPTIONS_T">5.2.4. ENQUEUE_OPTIONS_T</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_MESSAGE_PROPERTIES_T">5.2.5. MESSAGE_PROPERTIES_T</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_MESSAGE_PROPERTIES_ARRAY_T">5.2.6. MESSAGE_PROPERTIES_ARRAY_T</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_MSGID_ARRAY_T">5.2.7. MSGID_ARRAY_T</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_PAYLOAD_ARRAY_T">5.2.8. PAYLOAD_ARRAY_T</a></span></dt></dl></dd><dt><span class="section"><a href="chap_dbms_aq.html#d5e1679">5.3. 프러시저와 함수</a></span></dt><dd><dl><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE">5.3.1. DEQUEUE</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE_ARRAY">5.3.2. DEQUEUE_ARRAY</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_ENQUEUE">5.3.3. ENQUEUE</a></span></dt><dt><span class="section"><a href="chap_dbms_aq.html#DBMS_AQ_ENQUEUE_ARRAY">5.3.4. ENQUEUE_ARRAY</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 DBMS_AQ 패키지의 기본 개념과 패키지 내의 프러시저와 함수를 사용하는 방법을 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e1406"/>5.1. 개요</h2></div></div></div>
    

    <p><span><strong class="guibutton">DBMS_AQ</strong></span><a id="d5e1410" class="indexterm"/> 패키지는 <span>Tibero</span>의 Advanced Queuing 기능과 관련한 프러시저와 함수를
    제공한다. <span>Tibero</span>의 Advanced Queuing은 <span>Tibero</span> 데이터베이스와 통합되어 있는 메시지 Queuing 기능이다. 메시지는
    데이터베이스 테이블에 영속적으로 저장되며, 필요에 따라 SQL을 통해 직접 queue 테이블의 내용을 조회하는 것도
    가능하다.</p>

    <p>queue는 단일 소비자 queue 또는 복수 소비자 queue일 수 있다. 단일 소비자 queue에 메시지를
    enqueue하면 이 메시지는 오직 하나의 소비자만 dequeue할 수 있으며, 이 dequeue된 메시지를 또 다른 소비자가
    dequeue하는 것은 불가능하다. 복수 소비자 queue일 경우는 디폴트 구독자들 또는 별도로 지정한 수신자들을 대상으로
    enqueue를 수행할 수 있으며, 이때 각 소비자는 자신을 대상으로 enqueue된 메시지를 dequeue할 수 있다.</p>

    <p><span>tbCLI</span> 클라이언트는 자신이 관심있어 하는 queue에 enqueue가 수행될 때
    그 이벤트를 알림으로 받을 수 있도록 자신을 등록할 수 있다. 이때 콜백함수를 명시해 놓으면 알림을 받을 때마다 해당 콜백함수를
    수행하는 것이 가능하다.</p>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
      <p>메시지의 payload 타입은 현재 RAW 타입만 가능하고, <span>tbCLI</span>에서 알림 등록 및 콜백함수 수행에 대해서는 "<span>Tibero</span> <span>tbCLI</span> 안내서"를 참고한다.</p>
    </div>

    <p/>

    <div class="literallayout"><p/></div>

    <p>다음은 DBMS_AQ 패키지 내에 정의된 상수<a id="d5e1427" class="indexterm"/>이다.</p>

    <pre class="programlisting">IMMEDIATE CONSTANT PLS_INTEGER := 0;
ON_COMMIT CONSTANT PLS_INTEGER := 1;
BROWSE CONSTANT BINARY_INTEGER := 1;
LOCKED CONSTANT BINARY_INTEGER := 2;
REMOVE CONSTANT BINARY_INTEGER := 3;
REMOVE_NODATA CONSTANT BINARY_INTEGER := 4;
FIRST_MESSAGE CONSTANT BINARY_INTEGER := 1;
NEXT_MESSAGE CONSTANT BINARY_INTEGER := 3;
FOREVER CONSTANT BINARY_INTEGER := -1;
NO_WAIT CONSTANT BINARY_INTEGER := 0;
NAMESPACE_AQ CONSTANT BINARY_INTEGER := 1;</pre>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sect_dbms_aq_type"/>5.2. 타입</h2></div></div></div>
    

    <p>본 절에서는 DBMS_AQ 패키지에서 제공하는 별도 정의된 타입들을 알파벳 순으로 설명한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1433"/>5.2.1. AQ$_AGENT<a id="d5e1435" class="indexterm"/></h3></div></div></div>
      

      <p>메시지의 생산자 또는 소비자를 명시할 때 사용하는 타입이다.</p>

      <div class="literallayout"><p/></div>

      <p>AQ$_AGENT 타입<a id="d5e1441" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE AQ$_AGENT IS RECORD 
(
     name     VARCHAR2(30),
     address  VARCHAR2(1024) DEFAULT NULL,
     protocol NUMBER DEFAULT 0
);</pre>
        </li><li>
          <p>필드</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">필드 이름</th><th>설명</th></tr></thead><tbody><tr><td align="left">name</td><td>생산자 또는 소비자의 이름을 명시한다. 객체의 이름을 부여할 때와 동일한 규칙이
                  적용된다.</td></tr><tr><td align="left">address</td><td>현재 버전에서는 사용되지 않는다.</td></tr><tr><td align="left">protocol</td><td>현재 버전에서는 사용되지 않는다.</td></tr></tbody></table>
          </div>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1466"/>5.2.2. AQ$_RECIPIENT_LIST_T<a id="d5e1468" class="indexterm"/></h3></div></div></div>
      

      <p>메시지를 수신할 agent의 목록을 명시한다. 복수 소비자 queue에 대해서만 이 타입을 사용할 수
      있다.</p>

      <div class="literallayout"><p/></div>

      <p>AQ$_RECIPIENT_LIST_T 타입<a id="d5e1474" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE AQ$_RECIPIENT_LIST_T IS TABLE OF AQ$_AGENT
        INDEX BY BINARY_INTEGER;</pre>
        </li></ul></div>

      <p/>

      
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_DEQUEUE_OPTIONS_T"/>5.2.3. DEQUEUE_OPTIONS_T<a id="d5e1483" class="indexterm"/></h3></div></div></div>
      

      <p>dequeue할 때 적용할 수 있는 옵션들을 명시하는 타입이다.</p>

      <div class="literallayout"><p/></div>

      <p>DEQUEUE_OPTIONS_T 타입<a id="d5e1489" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE DEQUEUE_OPTIONS_T IS RECORD 
(
     consumer_name     VARCHAR2(30)    DEFAULT NULL,
     dequeue_mode      BINARY_INTEGER  DEFAULT REMOVE,
     navigation        BINARY_INTEGER  DEFAULT NEXT_MESSAGE,
     visibility        BINARY_INTEGER  DEFAULT ON_COMMIT,
     wait              BINARY_INTEGER  DEFAULT FOREVER,
     msgid             RAW(16)         DEFAULT NULL,
     correlation       VARCHAR2(128)   DEFAULT NULL,
     deq_condition     VARCHAR2(4000)  DEFAULT NULL
);</pre>
        </li><li>
          <p>필드</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">필드 이름</th><th>설명</th></tr></thead><tbody><tr><td align="left">consumer_name</td><td>소비자의 이름이다. 이 소비자에게 보내진 메시지만 dequeue가 된다. 단일 소비자
                  queue에 대해서는 이 값이 NULL이어야 한다.</td></tr><tr><td align="left">dequeue_mode</td><td><p>dequeue를 수행할 때 수행되는 잠금 방식을 결정한다.
                  </p><p>설정 가능한 값은 다음과 같다.</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                        <p>BROWSE : 아무런 잠금도 획득하지 않고 메시지 내용을 읽는다. 단순 select와
                        동일하다.</p>
                      </li><li style="list-style-type: circle">
                        <p>LOCKED : dequeue한 메시지를 읽으면서 잠금을 획득한다. 이 잠금은
                        트랜잭션이 유지되는 동안 유효하다. select for update와 동일하다고 할 수
                        있다.</p>
                      </li><li style="list-style-type: circle">
                        <p>REMOVE : 메시지를 읽고 지운다. (기본값)</p>
                      </li><li style="list-style-type: circle">
                        <p>REMOVE_NODATA : 메시지를 읽지 않고 지운다.</p>
                      </li></ul></div></td></tr><tr><td align="left">navigation</td><td><p>가져올 메시지의 위치를 결정한다. </p><p>설정 가능한 값은 다음과
                  같다.</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                        <p>NEXT_MESSAGE : 마지막 위치 다음에 있는 메시지를 가져온다.
                        (기본값)</p>
                      </li><li style="list-style-type: circle">
                        <p>FIRST_MESSAGE : 검색 조건에 맞는 첫 번째 메시지를 가져온다. 이 옵션을
                        사용하면 메시지의 위치가 초기화된다.</p>
                      </li></ul></div></td></tr><tr><td align="left">visibility</td><td><p>메시지를 dequeue하는 동작을 현재 트랜잭션에 같이 포함시킬지 결정한다.
                  dequeue_mode가 BROWSE일 경우 이 값은 무시된다. </p><p>설정 가능한 값은
                  다음과 같다.</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                        <p>ON_COMMIT : dequeue는 현재 트랜잭션에 포함된다.</p>
                      </li><li style="list-style-type: circle">
                        <p>IMMEDIATE : dequeue는 현재 트랜잭션에 참여하지 않고 자율 트랜잭션으로
                        수행되며, dequeue를 완료하면 자율 트랜잭션은 커밋된다.</p>
                      </li></ul></div></td></tr><tr><td align="left">wait</td><td><p>검색 조건에 해당하는 메시지가 없을 때 기다릴 시간을 명시한다.
                  </p><p>설정 가능한 값은 다음과 같다.</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                        <p>FOREVER : 영원히 기다린다. (기본값)</p>
                      </li><li style="list-style-type: circle">
                        <p>NO_WAIT : 기다리지 않고 바로 리턴한다.</p>
                      </li><li style="list-style-type: circle">
                        <p>숫자 : 기다릴 시간을 초 단위로 명시한다.</p>
                      </li></ul></div></td></tr><tr><td align="left">msgid</td><td>dequeue할 메시지 식별자를 명시한다.</td></tr><tr><td align="left">correlation</td><td>dequeue할 메시지의 연관 식별자를 명시한다. 퍼센트 기호(%) 또는 언더바(_)와 같은
                  패턴 대조에 사용되는 문자를 넣을 수 있다.</td></tr><tr><td align="left">deq_condition</td><td><p>메시지 속성 또는 메시지 데이터 속성에 대한 조건식을 지정한다. 이것은 SQL 문의
                  WHERE 절에 오는 것과 같은 형식의 참/거짓을 가지는 표현식이다.</p><p>메시지 속성은
                  queue 테이블에 존재하는 priority, corrid 또는 기타 다른 컬럼을
                  포함한다.</p></td></tr></tbody></table>
          </div>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_ENQUEUE_OPTIONS_T"/>5.2.4. ENQUEUE_OPTIONS_T<a id="d5e1567" class="indexterm"/></h3></div></div></div>
      

      <p>enqueue할 때 취할 수 있는 옵션들을 명시하는 타입이다.</p>

      <div class="literallayout"><p/></div>

      <p>ENQUEUE_OPTIONS_T 타입<a id="d5e1573" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE ENQUEUE_OPTIONS_T IS RECORD 
(
     visibility            BINARY_INTEGER  DEFAULT ON_COMMIT
);</pre>
        </li><li>
          <p>필드</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">필드 이름</th><th>설명</th></tr></thead><tbody><tr><td align="left">visibility</td><td><p>메시지를 enqueue하는 동작을 현재 트랜잭션에 같이 포함시킬지 결정한다.
                  </p><p>설정 가능한 값은 다음과 같다.</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                        <p>ON_COMMIT : enqueue는 현재 트랜잭션에 포함된다. (기본값)</p>
                      </li><li style="list-style-type: circle">
                        <p>IMMEDIATE : enqueue는 현재 트랜잭션에 참여하지 않고 자율 트랜잭션으로
                        수행되며, enqueue를 완료하면 자율 트랜잭션은 커밋된다.</p>
                      </li></ul></div></td></tr></tbody></table>
          </div>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_MESSAGE_PROPERTIES_T"/>5.2.5. MESSAGE_PROPERTIES_T<a id="d5e1601" class="indexterm"/></h3></div></div></div>
      

      <p>메시지 각각에 대한 여러 속성을 명시하는데 사용하는 타입이다. enqueue할 때는 이 속성을 채워서
      enqueue하며, dequeue할 때는 채웠던 속성이 반환된다.</p>

      <div class="literallayout"><p/></div>

      <p>MESSAGE_PROPERTIES_T 타입<a id="d5e1607" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE MESSAGE_PROPERTIES_T IS RECORD 
(
     priority          BINARY_INTEGER  NOT NULL DEFAULT 1,
     correlation       VARCHAR2(128)   DEFAULT NULL,
     recipient_list    AQ$_RECIPIENT_LIST_T,
     enqueue_time      DATE
);</pre>
        </li><li>
          <p>필드</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">필드 이름</th><th>설명</th></tr></thead><tbody><tr><td align="left">priority</td><td>메시지의 우선 순위를 명시한다. 숫자가 작을수록 우선 순위가 높은 것이다. 음수를 포함해 어떤
                  숫자도 가능하다.</td></tr><tr><td align="left">correlation</td><td>메시지를 enqueue할 때 생산자가 명시할 수 있는 연관 식별자이다.</td></tr><tr><td align="left">recipient_list</td><td><p>메시지를 전달할 수신자를 직접 명시할 때 사용하는 AQ$_AGENT agent에 대한
                  인덱스 테이블이다.</p><p>복수 소비자 queue에 대해서만 이 값을 명시할 수 있고, 이
                  값을 명시하지 않으면 디폴트 구독자들이 수신자가 된다. 이 파라미터는 dequeue할 때 소비자에게 반환되지
                  않는다.</p></td></tr><tr><td align="left">enqueue_time</td><td>메시지가 enqueue된 시점을 반환한다. 이 값은 시스템이 결정하며 enqueue할 때
                  사용자가 명시할 수 없다.</td></tr></tbody></table>
          </div>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_MESSAGE_PROPERTIES_ARRAY_T"/>5.2.6. MESSAGE_PROPERTIES_ARRAY_T<a id="d5e1639" class="indexterm"/></h3></div></div></div>
      

      <p>이 타입은 dbms_aq.enqueue_array나 dbms_aq.dequeue_array를 호출할 때 여러 메시지에
      대한 속성을 함께 명시하기 위해 사용한다. 즉, payload_array에 명시된 payload 갯수만큼
      message_properties_array_t varray에 속성들이 명시되어야 한다.</p>

      <div class="literallayout"><p/></div>

      <p>MESSAGE_PROPERTIES_ARRAY_T 타입<a id="d5e1645" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE MESSAGE_PROPERTIES_ARRAY_T IS VARRAY (2147483647)
        OF MESSAGE_PROPERTIES_T;</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_MSGID_ARRAY_T"/>5.2.7. MSGID_ARRAY_T<a id="d5e1653" class="indexterm"/></h3></div></div></div>
      

      <p>이 타입은 dbms_aq.enqueue_array나 dbms_aq.dequeue_array를 호출할 때
      enqueue되거나 dequeue된 메시지 식별자들을 반환하기 위한 용도로 사용한다.</p>

      <div class="literallayout"><p/></div>

      <p>MSGID_ARRAY_T 타입<a id="d5e1659" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE MSGID_ARRAY_T IS TABLE OF RAW(16) INDEX BY BINARY_INTEGER;</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_PAYLOAD_ARRAY_T"/>5.2.8. PAYLOAD_ARRAY_T<a id="d5e1667" class="indexterm"/></h3></div></div></div>
      

      <p>이 타입은 dbms_aq.enqueue_array나 dbms_aq.dequeue_array를 호출할 때 payload
      여러 개를 함께 명시하기 위해 사용한다. 현재 payload는 RAW 타입만 지원된다.</p>

      <div class="literallayout"><p/></div>

      <p>PAYLOAD_ARRAY_T 타입<a id="d5e1673" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">TYPE PAYLOAD_ARRAY_T IS VARRAY(2147483647) OF RAW(32767);</pre>
        </li></ul></div>

      
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e1679"/>5.3. 프러시저와 함수</h2></div></div></div>
    

    <p>본 절에서는 DBMS_AQ 패키지에서 제공하는 프러시저와 함수를 알파벳 순으로 설명한다.</p>

    <p/>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_DEQUEUE"/>5.3.1. DEQUEUE<a id="d5e1685" class="indexterm"/></h3></div></div></div>
      

      <p>대상 queue로부터 메시지를 하나 dequeue한다. 어떤 메시지를 dequeue할 것인가는
      dequeue_options의 consumer_name, msgid, correlation 또는 deq_condition에 무엇을
      명시했느냐에 따라 결정된다. 각각에 대한 설명은 <a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE_OPTIONS_T" title="5.2.3. DEQUEUE_OPTIONS_T">“5.2.3. DEQUEUE_OPTIONS_T”</a>를
      참고한다.</p>

      <p>dequeue되는 메시지의 순서는 queue 테이블을 생성할 때 명시하는 정렬 순서에 의해 결정된다.
      dequeue_options에 msgid 또는 correlation을 명시하면 이 순서를 무시할 수 있다. enqueue 및
      dequeue도 일반 데이터베이스 동작과 마찬가지로 일관성 읽기 규칙이 적용된다. 예를 들어 BROWSE가 시작되고 나서
      enqueue된 메시지가 보이지 않을 수 있다.</p>

      <p>navigation 파라미터의 기본값은 NEXT_MESSAGE이다. 이것은 반복적인 dequeue를 수행할 때 맨 처음
      dequeue를 수행했을 때의 스냅샷을 기준으로 메시지들이 순차적으로 반환됨을 의미한다. 즉, 첫 번째 dequeue를 수행한
      이후에 enqueue된 메시지는 현재 dequeue하고 있는 메시지들이 다 소비된 이후에만 소비가 가능하다. 일반적으로는 이렇게
      동작해도 문제가 없지만 우선 순위와 같은 이유로 dequeue할 때 항상 queue의 첫 번째 메시지를 dequeue해야 할
      경우는 FIRST_MESSAGE 옵션을 사용해야만 한다. 예를 들어 기존에 enqueue된 메시지를 처리하는 중에 더 높은 우선
      순위의 메시지가 enqueue되었을 경우 이를 먼저 처리하기 위해서 이 옵션이 필요하다.</p>

      <div class="literallayout"><p/></div>

      <p>DEQUEUE 프러시저<a id="d5e1694" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_AQ.DEQUEUE 
(
    queue_name         IN  VARCHAR2,
    dequeue_options    IN  DEQUEUE_OPTIONS_T,
    message_properties OUT MESSAGE_PROPERTIES_T,
    payload            OUT RAW,
    msgid              OUT RAW
);</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">queue_name</td><td>메시지를 dequeue할 queue의 이름을 명시한다.</td></tr><tr><td align="left">dequeue_options</td><td>dequeue할 모든 메시지에 동일하게 적용되는 옵션을 명시한다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE_OPTIONS_T" title="5.2.3. DEQUEUE_OPTIONS_T">“5.2.3. DEQUEUE_OPTIONS_T”</a>를 참고한다.</td></tr><tr><td align="left">message_properties</td><td>반환되는 메시지 속성들을 명시한다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_MESSAGE_PROPERTIES_T" title="5.2.5. MESSAGE_PROPERTIES_T">“5.2.5. MESSAGE_PROPERTIES_T”</a>를 참고한다.</td></tr><tr><td align="left">payload</td><td>사용자가 지정하는 payload이다. 현재는 RAW 타입만 가능하다.</td></tr><tr><td align="left">msgid</td><td>dequeue된 메시지에 대한 식별자이다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">DECLARE
dequeue_options     DBMS_AQ.dequeue_options_t;
message_properties  DBMS_AQ.message_properties_t;
message_handle      RAW(16);
message             raw(1000);
BEGIN
   dequeue_options.consumer_name := 'RED';
   dequeue_options.deq_condition := 'enq_time is not null';
   DBMS_AQ.DEQUEUE(
      queue_name          =&gt;     'my_multi_q',
      dequeue_options     =&gt;     dequeue_options,
      message_properties  =&gt;     message_properties,
      payload             =&gt;     message,
      msgid               =&gt;     message_handle);
   dbms_output.put_line('msgid: ' || message_handle);
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_DEQUEUE_ARRAY"/>5.3.2. DEQUEUE_ARRAY<a id="d5e1732" class="indexterm"/></h3></div></div></div>
      

      <p>여러 메시지를 한꺼번에 dequeue하고 그것을 payload의 배열, 메시지 속성의 배열, 메시지 식별자의 배열로
      반환하는 함수이다. 함수의 반환값은 성공적으로 dequeue된 메시지의 갯수이다.</p>

      <p>dequeue_options에 명시된 wait 시간은 dequeue를 수행할 때 queue에 dequeue할 메시지가
      아무것도 존재하지 않을 때만 적용된다. 만일 dequeue할 수 있는 메시지가 queue에 하나 이상 존재하면
      DEQUEUE_ARRAY 함수는 최대 array_size 만큼의 메시지를 dequeue한 후 즉시 리턴된다.</p>

      <p>dequeue_options로 msgid는 명시할 수 없다. navigation 파라미터와 관련한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE_OPTIONS_T" title="5.2.3. DEQUEUE_OPTIONS_T">“5.2.3. DEQUEUE_OPTIONS_T”</a>를 참고한다.</p>

      <div class="literallayout"><p/></div>

      <p>DEQUEUE_ARRAY 함수<a id="d5e1741" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_AQ.DEQUEUE_ARRAY 
(
    queue_name                IN   VARCHAR2,
    dequeue_options           IN   DEQUEUE_OPTIONS_T,
    array_size                IN   PLS_INTEGER,
    message_properties_array  OUT  MESSAGE_PROPERTIES_ARRAY_T,
    payload_array             OUT  PAYLOAD_ARRAY_T,
    msgid_array               OUT  MSGID_ARRAY_T
) 
RETURN pls_integer;</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">queue_name</td><td>메시지들을 dequeue할 queue의 이름을 명시한다.</td></tr><tr><td align="left">dequeue_options</td><td>dequeue할 모든 메시지에 동일하게 적용되는 옵션을 명시한다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_DEQUEUE_OPTIONS_T" title="5.2.3. DEQUEUE_OPTIONS_T">“5.2.3. DEQUEUE_OPTIONS_T”</a>를 참고한다.</td></tr><tr><td align="left">array_size</td><td>dequeue할 메시지의 수를 지정한다.</td></tr><tr><td align="left">message_properties_array</td><td>반환되는 메시지 속성들에 대한 배열이다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_MESSAGE_PROPERTIES_ARRAY_T" title="5.2.6. MESSAGE_PROPERTIES_ARRAY_T">“5.2.6. MESSAGE_PROPERTIES_ARRAY_T”</a>를
                  참고한다.</td></tr><tr><td align="left">payload_array</td><td>반환되는 payload들에 대한 배열이다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_PAYLOAD_ARRAY_T" title="5.2.8. PAYLOAD_ARRAY_T">“5.2.8. PAYLOAD_ARRAY_T”</a>를 참고한다.</td></tr><tr><td align="left">msgid_array</td><td>dequeue된 메시지들의 메시지 식별자가 반환되는 배열이다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_MSGID_ARRAY_T" title="5.2.7. MSGID_ARRAY_T">“5.2.7. MSGID_ARRAY_T”</a>를 참고한다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">declare
  dequeue_options       DBMS_AQ.dequeue_options_t;
  msg_prop_array        DBMS_AQ.message_properties_array_t;
  payload_array         dbms_aq.payload_array_t;
  msgid_array           DBMS_AQ.msgid_array_t;
  retval                PLS_INTEGER;
BEGIN
  dequeue_options.consumer_name := 'RED';

  retval := DBMS_AQ.DEQUEUE_ARRAY(
              queue_name               =&gt; 'my_multi_q',
              dequeue_options          =&gt; dequeue_options,
              array_size               =&gt; 10,
              message_properties_array =&gt; msg_prop_array,
              payload_array            =&gt; payload_array,
              msgid_array              =&gt; msgid_array);

  DBMS_OUTPUT.PUT_LINE('Number of messages dequeued: ' || retval);
  for i in 1..retval loop
    dbms_output.put_line ('msgid('||i||'): ' || msgid_array(i));
  end loop;
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_ENQUEUE"/>5.3.3. ENQUEUE<a id="d5e1784" class="indexterm"/></h3></div></div></div>
      

      <p>대상 queue에 메시지를 하나 enqueue한다. 복수 소비자 queue에 enqueue를 수행할 때 이 queue에
      디폴트 구독자가 하나도 등록되어 있지 않은 상태에서 수신자를 명시하지 않으면 메시지를 전달할 곳이 없으므로 에러를
      반환한다.</p>

      <div class="literallayout"><p/></div>

      <p>ENQUEUE 프러시저<a id="d5e1790" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_AQ.ENQUEUE 
(
    queue_name         IN  VARCHAR2,
    enqueue_options    IN  ENQUEUE_OPTIONS_T,
    message_properties IN  MESSAGE_PROPERTIES_T,
    payload            IN  RAW,
    msgid              OUT RAW
);</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">queue_name</td><td>메시지를 enqueue할 queue의 이름을 명시한다.</td></tr><tr><td align="left">enqueue_options</td><td>enqueue할 모든 메시지에 동일하게 적용되는 옵션을 명시한다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_ENQUEUE_OPTIONS_T" title="5.2.4. ENQUEUE_OPTIONS_T">“5.2.4. ENQUEUE_OPTIONS_T”</a>를 참고한다.</td></tr><tr><td align="left">message_properties</td><td>enqueue할 메시지들의 메시지 속성을 명시한다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_MESSAGE_PROPERTIES_T" title="5.2.5. MESSAGE_PROPERTIES_T">“5.2.5. MESSAGE_PROPERTIES_T”</a>를 참고한다.</td></tr><tr><td align="left">payload</td><td>사용자가 지정하는 payload이다. 현재는 RAW 타입만 가능하다.</td></tr><tr><td align="left">msgid</td><td>시스템이 부여한 메시지 식별자를 반환한다. 유일성이 보장되며 dequeue할 때 메시지 식별
                  용도로 사용 가능하다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">DECLARE
   enqueue_options     DBMS_AQ.enqueue_options_t;
   message_properties  DBMS_AQ.message_properties_t;
   message_handle      RAW(16);
BEGIN
   message_properties.priority := 2;
   message_properties.correlation := 'abc';
   DBMS_AQ.ENQUEUE(
      queue_name              =&gt; 'my_q',
      enqueue_options         =&gt; enqueue_options,
      message_properties      =&gt; message_properties,
      payload                 =&gt; hextoraw('FFFF'),
      msgid                   =&gt; message_handle);
   dbms_output.put_line('msgid: ' || message_handle);
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_AQ_ENQUEUE_ARRAY"/>5.3.4. ENQUEUE_ARRAY<a id="d5e1828" class="indexterm"/></h3></div></div></div>
      

      <p>이 함수는 각각의 해당되는 메시지 속성과 함께 여러 payload를 한꺼번에 enqueue하는 함수이다. 완료와 함께
      enqueue된 메시지의 식별자들을 담는 배열이 반환된다. 함수의 반환값은 성공적으로 enqueue된 메시지의
      갯수이다.</p>

      <div class="literallayout"><p/></div>

      <p>ENQUEUE_ARRAY 함수<a id="d5e1834" class="indexterm"/>의 세부 내용은 다음과 같다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_AQ.ENQUEUE_ARRAY 
(
    queue_name               IN  VARCHAR2,
    enqueue_options          IN  ENQUEUE_OPTIONS_T,
    array_size               IN  PLS_INTEGER,
    message_properties_array IN  MESSAGE_PROPERTIES_ARRAY_T,
    payload_array            IN  PAYLOAD_ARRAY_T,
    msgid_array              OUT MSGID_ARRAY_T
) 
RETURN pls_integer;</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">queue_name</td><td>메시지들을 enqueue할 queue의 이름을 명시한다.</td></tr><tr><td align="left">enqueue_options</td><td>enqueue할 모든 메시지에 동일하게 적용되는 옵션을 명시한다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_ENQUEUE_OPTIONS_T" title="5.2.4. ENQUEUE_OPTIONS_T">“5.2.4. ENQUEUE_OPTIONS_T”</a>를 참고한다.</td></tr><tr><td align="left">array_size</td><td>enqueue할 메시지의 수를 지정한다.</td></tr><tr><td align="left">message_properties_array</td><td>enqueue할 메시지들의 메시지 속성에 대한 배열이다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_MESSAGE_PROPERTIES_ARRAY_T" title="5.2.6. MESSAGE_PROPERTIES_ARRAY_T">“5.2.6. MESSAGE_PROPERTIES_ARRAY_T”</a>를
                  참고한다.</td></tr><tr><td align="left">payload_array</td><td>enqueue할 메시지들의 payload에 대한 배열이다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_PAYLOAD_ARRAY_T" title="5.2.8. PAYLOAD_ARRAY_T">“5.2.8. PAYLOAD_ARRAY_T”</a>를 참고한다.</td></tr><tr><td align="left">msgid_array</td><td>enqueue된 메시지들의 메시지 식별자가 반환되는 배열이다. 자세한 내용은 <a href="chap_dbms_aq.html#DBMS_AQ_MSGID_ARRAY_T" title="5.2.7. MSGID_ARRAY_T">“5.2.7. MSGID_ARRAY_T”</a>를 참고한다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">declare
  v               dbms_aq.payload_array_t;
  msg_prop_array  dbms_Aq.message_properties_array_t;
  retval          pls_integer;
  msgid_array     dbms_aq.msgid_array_t;
  enqueue_options DBMS_AQ.enqueue_options_t;
begin
  v := dbms_aq.payload_array_t (hextoraw('FFFF'), hextoraw('EEEE'), 
       hextoraw('EEEE'), hextoraw('EEEE'), hextoraw('EEEE'), hextoraw('EEEE'));
  msg_prop_array := dbms_aq.message_properties_array_t ();
  msg_prop_array.extend(6);

  for i in 1..6 loop
    msg_prop_array(i).priority := 7 - i;
  end loop;

  retval := dbms_aq.enqueue_array (
      queue_name               =&gt; 'my_multi_q',
      enqueue_options          =&gt; enqueue_options,
      array_size               =&gt; 6,
      message_properties_array =&gt; msg_prop_array,
      payload_array            =&gt; v,
      msgid_array              =&gt; msgid_array);
  dbms_output.put_line('processed: ' || retval);
  for i in 1..retval loop
    dbms_output.put_line ('msgid('||i||'): ' || msgid_array(i));
  end loop;
end;
/</pre>
        </li></ul></div>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap_dbms_application_info.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="chap_dbms_aqadm.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제4장 DBMS_APPLICATION_INFO </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제6장 DBMS_AQADM</td></tr></table></div><div xmlns="" align="center"/></body></html>