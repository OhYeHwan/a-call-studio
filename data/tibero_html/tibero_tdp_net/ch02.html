<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제2장 TDP.NET 기본 사용</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero TDP.NET 안내서"/><link rel="up" href="index.html" title="Tibero TDP.NET 안내서"/><link rel="prev" href="ch01.html" title="제1장 Tibero TDP.NET 소개"/><link rel="next" href="ch03.html" title="제3장 API 구현 목록"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제2장 TDP.NET 기본 사용</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="ch03.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="d5e444"/>제2장 TDP.NET 기본 사용</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="ch02.html#d5e447">2.1. 개발 과정</a></span></dt><dt><span class="section"><a href="ch02.html#d5e508">2.2. Connection Properties</a></span></dt><dt><span class="section"><a href="ch02.html#d5e597">2.3. 데이터 타입</a></span></dt><dt><span class="section"><a href="ch02.html#d5e710">2.4. 기본 예제</a></span></dt><dt><span class="section"><a href="ch02.html#d5e726">2.5. psm 호출</a></span></dt></dl></div>
  

  <p>본 장에서는 TDP.NET을 사용하여 애플리케이션 프로그램을 개발하는 과정을 순서대로 설명하고, 연결 속성, 데이터 타입,
  PSM 호출 방법 등을 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e447"/>2.1. 개발 과정</h2></div></div></div>
    

    <p>다음은 TDP.NET 을 사용하여 애플리케이션 프로그램을 개발하는 과정에 대한 설명이다.</p>

    <div class="orderedlist"><ol type="1"><li>
        <p><span><strong class="guibutton">네임스페이스 추가</strong></span></p>

        <p>기본이 되는 Tibero.DataAccess.Client 네임스페이스를 추가한다.</p>

        <pre class="programlisting">using Tibero.DataAccess.Client;</pre>
      </li><li>
        <p><span><strong class="guibutton">데이터베이스 연결</strong></span></p>

        <p>데이터베이스에 연결하기 위해서 접속 정보를 Connection string으로 직접 명시하여
        TiberoConnection 객체를 생성한 뒤 Open() 메소드를 호출하여 데이터베이스에 접속한다.</p>

        <pre class="programlisting">string connStr = "Data Source=((INSTANCE="
                  + "(HOST=localhost)(PORT=8629)(DB_NAME=dbsvr)));"
                  + "User Id=tibero;Password=tmax;"; 
TbieroConnection conn = new TiberoConnection(connStr); 
conn.Open(); </pre><p>또는 다음과 같이 TiberoConnectionStringBuilder를 통해
        Connection string을 생성하여 TiberoConnection 객체를 생성할 수 있다.</p>

        <pre class="programlisting">TiberoConnectionStringBuilder builder = new TiberoConnectionStringBuilder();
builder.DataSource = "((INSTANCE=(HOST=localhost)(PORT=8629)(DB_NAME=dbsvr)))";
builder.UserID = "tibero";
builder.Password = "tmax";

TbieroConnection conn = new TiberoConnection(builder.ToString());
conn.Open(); </pre>

        <p>Connection string의 Data Source에 Data Source Name을 명시하면,
        $TB_HOME/client/config/tbdsn.tbr 파일에 명시된 DSN의 HOST, PORT, DB_NAME을
        파싱하여 접속 정보로 사용한다.</p>

        <pre class="programlisting">string connStr = "Data Source=tibero;User Id=tibero;Password=tmax;";
TbieroConnection conn = new TiberoConnection(connStr); 
conn.Open(); </pre>
      </li><li>
        <p><span><strong class="guibutton">TiberoCommand 객체 생성과 SQL문 수행</strong></span></p>

        <p>데이터베이스에 연결되면, TiberoCommand 객체를 생성한 뒤 ExecuteXXX() 메소드를 통해 SQL
        커맨드를 데이터베이스에 보낸다.</p>

        <pre class="programlisting">conn.Open();
TiberoCommand cmd = new TiberoCommand("create table t (c1 varchar2(10), c2 number)", 
                                      conn);
cmd.ExecuteNonQuery();</pre>
      </li><li>
        <p><span><strong class="guibutton">질의문 수행과 TiberoDataReader 객체 받기</strong></span></p>

        <p>커맨드 객체를 생성하여 질의문을 수행하고 TiberoDataReader 객체를 받는다.</p>

        <pre class="programlisting">TiberoCommand cmd = new TiberoCommand("select * from t");
cmd.Connection = conn;
cmd.CommandType = CommandType.Text;
TiberoDataReader reader = cmd.ExecuteReader();</pre>
      </li><li>
        <p><span><strong class="guibutton">TiberoDataReader 객체 처리</strong></span></p>

        <p>TiberoDataReader 객체는 Read() 메소드를 이용하여 결과 집합의 각 로우에 순차적으로 접근할 수
        있다. 더이상 읽을 로우가 없으면 Read() 메소드는 false를 반환한다. TiberoDataReader의 GetXXX()
        메소드 호출을 통해 컬럼 값을 얻거나, 컬럼 배열에 접근하는 직관적인 방식으로 컬럼 값을 얻어 올 수 있다.</p>

        <pre class="programlisting">while (reader.Read())
{
   string c1 = reader.GetString(0);
   int c2 = reader["c2"];
}</pre>
      </li><li>
        <p><span><strong class="guibutton">TiberoDataAdapter를 통한 질의문 수행</strong></span></p>

        <p>TiberoDataAapter를 통해서도 데이터베이스에 커맨드를 요청하고, Fill 메소드를 통해 DataSet
        객체에 결과 집합을 담을 수 있다. 데이터베이스와의 연결이 닫혀있는 상태일지라도, Fill 메소드 내부에서 암시적으로
        데이터베이스와 연결을 맺어 데이터를 조회해온 후 다시 연결을 해제하여 연결 상태를 닫힌 상태로 원복한다.</p>

        <pre class="programlisting">TiberoCommand cmd = new TiberoCommand("select * from t", conn);
DataSet ds = new DataSet();
TiberoDataAdapter da = new TiberoDataAdapter(cmd);

da.Fill(ds);
foreach (DataRow r in ds.Tables[0].Rows)
{
   Console.WriteLine(r[0] + "," + r[1]);
}</pre>
      </li><li>
        <p><span><strong class="guibutton">데이터베이스 연결 해제</strong></span></p>

        <p>TiberoConnection 객체의 Close() 메소드를 호출하면 데이터베이스와의 연결이 해제된다.</p>

        <pre class="programlisting">conn.Close();</pre>

        <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
            <p>Close() 메소드를 호출하지 않으면 불필요한 커넥션이 남아서 성능 저하를 유발시킬 수 있으므로, 항상
            Close() 메소드를 사용하여 연결을 해제해야 한다.</p>
          </div>
      </li><li>
        <p><span><strong class="guibutton">객체 소멸</strong></span></p>

        <p>명시적으로 Dispose() 메소드를 호출하면 TiberoDataReader, TiberoCommand,
        TiberoConnection 등의 객체가 사용한 리소스가 정리되며 소멸된다.</p>

        <pre class="programlisting">cmd.Dispose();
reader.Dispose();
conn.Dispose();</pre>
      </li></ol></div>

    <p/>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e508"/>2.2. Connection Properties</h2></div></div></div>
    

    <p>다음은 데이터베이스에 연결할 때에 Connection String을 통해 설정할 수 있는
    속성들이다.</p><div class="informaltable">
        <table border="1"><colgroup><col width="150" align="left"/><col width="60" align="left"/><col/></colgroup><thead><tr><th align="left">속성명</th><th align="left">타입</th><th>설명</th></tr></thead><tbody><tr><td align="left">DB_NAME</td><td align="left">String</td><td>서버에 존재하는 특정 데이터베이스의 이름이다.</td></tr><tr><td align="left">Data Source</td><td align="left">String</td><td>데이터소스의 이름이다.</td></tr><tr><td align="left">INSTANCE</td><td align="left">String</td><td>접속할 인스턴스 정보다.</td></tr><tr><td align="left">Password</td><td align="left">String</td><td>서버 접속을 위한 패스워드이다.</td></tr><tr><td align="left">User Id</td><td align="left">String</td><td>서버 접속을 위한 사용자 이름이다.</td></tr><tr><td align="left">PORT</td><td align="left">String</td><td>서버 리스너의 포트 번호이다.</td></tr><tr><td align="left">HOST</td><td align="left">String</td><td>접속할 인스턴스의 호스트 및 IP 주소 정보다.</td></tr><tr><td align="left">Enlist</td><td align="left">String</td><td><p>트랙잭션 범위 내에서 Connection open할 때 암시적으로
              System.Transactions의 트랜잭션에 참여할지 여부를 지정한다. </p><p>(기본값:
              True)</p></td></tr><tr><td align="left">Pooling</td><td align="left">String</td><td><p>Connection Pooling 기능을 사용할지 여부를 지정한다.
              </p><p>(기본값: True)</p></td></tr><tr><td align="left">Min Pool Size</td><td align="left">String</td><td>한 개의 Connection Pool 내에 존재해야 하는 커넥션의 최소 갯수이다. (기본값:
              1)</td></tr><tr><td align="left">Max Pool Size</td><td align="left">String</td><td>한 개의 Connection Pool 내에 존재할 수 있는 커넥션의 최대 갯수이다. (기본값:
              100)</td></tr><tr><td align="left">Decr Pool Size</td><td align="left">String</td><td>Connection Pool 내의 커넥션들의 단위 감소량이다. (기본값: 1)</td></tr><tr><td align="left">Incr Pool Size</td><td align="left">String</td><td>Connection Pool 내의 커넥션들의 단위 증가량이다. (기본값: 5)</td></tr><tr><td align="left">Validate Connection</td><td align="left">String</td><td><p>Connection Pool에서 커넥션을 가져올 때마다 데이터베이스 연결 유효성 검사를 할지
              여부를 지정한다.</p><p>True로 지정하면, 연결 유효성 검사에 따른 오버헤드가 생긴다는 것을
              감안해야 한다. (기본값: False)</p></td></tr><tr><td align="left">Connection Timeout</td><td align="left">String</td><td>Connection Pool에서 커넥션을 가져올 때 Max Pool Size 만큼의 커넥션들이 모두
              Busy 상태일 경우 커넥션을 획득하기 위해 기다리는 최대 시간이다. (단위: 초, 기본값: 15초)</td></tr><tr><td align="left">Promotable Transaction</td><td align="left">String</td><td><p>분산 트랜잭션으로의 승격 가능 여부를 지정한다. </p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>Promotable (기본값)</p>
                  </li><li style="list-style-type: circle">
                    <p>Local</p>
                  </li></ul></div></td></tr></tbody></table>
      </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e597"/>2.3. 데이터 타입</h2></div></div></div>
    

    <p>다음은 TDP.NET에서 제공하는 타입의 Value 속성과 .NET 프레임워크 데이터 타입의 대응 관계이다.
    Tibero.DataAccess.Types 네임스페이스를 추가하면 TDP.NET 타입을 사용할 수 있다.</p>

    <div class="informaltable">
        <table border="1"><colgroup><col width="200" align="left"/><col/><col/></colgroup><thead><tr><th align="left">Tibero DB 데이터 타입</th><th>TDP.NET 타입</th><th>.NET 프레임워크 데이터 타입</th></tr></thead><tbody><tr><td align="left">BFILE</td><td>TiberoBFile</td><td>System.Byte[]</td></tr><tr><td align="left">BINARY_DOUBLE</td><td>TiberoDecimal</td><td>System.Decimal</td></tr><tr><td align="left">BINARY_FLOAT</td><td>TiberoDecimal</td><td>System.Decimal</td></tr><tr><td align="left">BINARY_INTEGER</td><td>TiberoDecimal</td><td>System.Decimal</td></tr><tr><td align="left">BLOB</td><td>TiberoBlob</td><td>System.Byte[]</td></tr><tr><td align="left">BOOLEAN</td><td>TiberoBoolean</td><td>System.Boolean</td></tr><tr><td align="left">CHAR</td><td>TiberoString</td><td>System.String</td></tr><tr><td align="left">CLOB</td><td>TiberoClob</td><td>System.String</td></tr><tr><td align="left">DATE</td><td>TiberoDate</td><td>System.DateTime</td></tr><tr><td align="left">INTERVAL DAY TO SECOND</td><td>TiberoIntervalDS</td><td>System.TimeSpan</td></tr><tr><td align="left">INTERVAL YEAR TO MONTH</td><td>TiberoIntervalYM</td><td>System.Int64</td></tr><tr><td align="left">LONG</td><td>TiberoString</td><td>System.Byte[]</td></tr><tr><td align="left">LONG RAW</td><td>TiberoBinary</td><td>System.Byte[]</td></tr><tr><td align="left">NCHAR</td><td>TiberoString</td><td>System.String</td></tr><tr><td align="left">NCLOB</td><td>TiberoClob</td><td>System.String</td></tr><tr><td align="left">NUMBER</td><td>TiberoDecimal</td><td>System.Decimal</td></tr><tr><td align="left">NVARCHAR2</td><td>TiberoString</td><td>System.String</td></tr><tr><td align="left">REF</td><td>TiberoRef</td><td>System.String</td></tr><tr><td align="left">REF CURSOR</td><td>TiberoRefCursor</td><td>-</td></tr><tr><td align="left">ROWID</td><td>TiberoString</td><td>System.String</td></tr><tr><td align="left">TIMESTAMP</td><td>TiberoTimeStamp</td><td>System.DateTime</td></tr><tr><td align="left">TIMESTAMP WITH LOCAL TIME ZONE</td><td>TiberoTimeStampLTZ</td><td>System.DateTime</td></tr><tr><td align="left">TIMESTAMP WITH TIME ZONE</td><td>TiberoTimeStampTZ</td><td>System.DateTime</td></tr><tr><td align="left">VARCHAR2</td><td>TiberoString</td><td>System.String</td></tr><tr><td align="left">XMLTYPE</td><td>TiberoXmlType</td><td>System.String</td></tr></tbody></table>
      </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e710"/>2.4. 기본 예제</h2></div></div></div>
    

    <p>다음은 파라미터를 바인딩하여 DML을 수행하는 예제에 대한 설명이다.</p>

    <div class="orderedlist"><ol type="1"><li>
        <p><span><strong class="guibutton">BindbyName 설정 후 파라미터 바인딩 </strong></span></p>

        <p>TiberoCommand 객체의 BindbyName 값을 True로 설정하는 경우 지정한 파라미터의 이름에 따라
        바인딩된다.</p>

        <pre class="programlisting">TiberoCommand cmd = new TiberoCommand("create table test " + 
                                      "(c1 varchar2(20), c2 varchar2(20))",
                                      conn);
cmd.ExecuteNonQuery();
cmd = new TiberoCommand("insert into test values (:col1, :col2)", conn);
cmd.BindByName = true;

TiberoParameter param = new TiberoParameter();
param.ParameterName = "col2";
param.TiberoDbType = TiberoDbType.Varchar2;
param.Direction = ParameterDirection.Input;
param.Size = 20;
param.CollectionType = TiberoCollectionType.None;
param.Value = "second column";
cmd.Parameters.Add(param);
cmd.Parameters.Add("col1", TiberoDbType.Varchar2).Value = "first column";
int affectedRowCnt = cmd.ExecuteNonQuery();</pre>
      </li><li>
        <p><span><strong class="guibutton">일반적인 파라미터 바인딩</strong></span></p>

        <p>TiberoCommand 객체에 BindbyName 설정을 별도로 하지 않으면 기본값은 False로 설정된다.
        따라서 파라미터의 이름은 의미가 없고 파라미터를 추가하는 순서대로 바인딩 됨을 주의해야 한다.</p>

        <pre class="programlisting">TiberoCommand cmd = new TiberoCommand("create table test2 " +
                                      "(c1 date, c2 number, c3 number)", conn);
cmd.ExecuteNonQuery();
cmd = new TiberoCommand("insert into test2 values (:col1, :col2, :colNull)", conn);

DateTime dt = new DateTime(2020, 3, 23, 17, 50, 30);
cmd.Parameters.Add("col1", TiberoDbType.Date, dt, ParameterDirection.Input);
cmd.Parameters.Add("col2", TiberoDbType.Decimal, 123.45m, ParameterDirection.Input);
cmd.Parameters.Add("col3", null);
int affectedRowCnt = cmd.ExecuteNonQuery();</pre>
      </li></ol></div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e726"/>2.5. psm 호출</h2></div></div></div>
    

    <p>다음은 ref 커서를 아웃 파라미터로 바인딩하여 Stored Procedure를 수행하여 테이블의 데이터를 조회해오는
    예제에 대한 설명이다.</p>

    <pre class="programlisting">TiberoCommand cmd = new TiberoCommand("create table test3 " +
                                      "(c1 varchar(50), c2 number)", conn);
cmd.ExecuteNonQuery();
cmd = new TiberoCommand("insert into test3 values ('hello', 10)", conn);
cmd.ExecuteNonQuery();
cmd = new TiberoCommand("create or replace procedure " + 
                        "out_cursor(p1 out sys_refcursor)" +
                        "as " + 
                        "begin " +
                        "open p1 for 'select * from test3'; " +
                        "end; ", conn);
cmd.ExecuteNonQuery();
cmd = new TiberoCommand();
cmd.Connection = conn;
cmd.CommandText = "out_cursor";
cmd.CommandType = CommandType.StoredProcedure;
cmd.Parameters.Add("csr",TiberoDbType.RefCursor, ParameterDirection.Output);

TiberoDataAdapter oAdapter = new TiberoDataAdapter(cmd);
DataSet ds = new DataSet();
oAdapter.Fill(ds);
foreach (DataRow r in ds.Tables[0].Rows)
{
   Console.WriteLine(r[0] + ", " + r[1]);
}</pre>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch03.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제1장 Tibero TDP.NET 소개 </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제3장 API 구현 목록</td></tr></table></div><div xmlns="" align="center"/></body></html>