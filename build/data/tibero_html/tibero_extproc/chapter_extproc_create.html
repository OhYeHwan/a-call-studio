<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제3장 C External Procedure 생성</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero External Procedure 안내서"/><link rel="up" href="index.html" title="Tibero External Procedure 안내서"/><link rel="prev" href="chapter_extproc.html" title="제2장 C External Procedure"/><link rel="next" href="sect_extproc_using.html" title="제4장 C External Procedure 사용"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제3장 C External Procedure 생성</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chapter_extproc.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="sect_extproc_using.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chapter_extproc_create"/>제3장 C External Procedure 생성</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chapter_extproc_create.html#d5e521">3.1. 기본 환경 설정</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_extproc_create.html#d5e529">3.1.1. 초기화 파라미터</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_extproc_create.html#d5e648">3.2. 생성 절차</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_extproc_create.html#sect_user_shlib_create">3.2.1. 사용자 공유 라이브러리 생성</a></span></dt><dt><span class="section"><a href="chapter_extproc_create.html#sect_lib_object_create">3.2.2. Library Object 등록</a></span></dt><dt><span class="section"><a href="chapter_extproc_create.html#sect_user_func_psm">3.2.3. 사용자 함수를 PSM에 대응</a></span></dt><dt><span class="section"><a href="chapter_extproc_create.html#sect_user_func_exec">3.2.4. 사용자 함수 실행</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 C External Procedure를 생성하는 절차를 기본 환경 설정과 생성 절차 단계로 나누어
  설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e521"/>3.1. 기본 환경 설정</h2></div></div></div>
    

    <p>C External Procedure는 이전 장에서도 언급했듯이 <span>tbEPA</span>
    프로세스에 의해 수행된다. <span>tbEPA</span> 프로세스를 실행하는 바이너리 파일은 $<span>TB_</span>HOME/client/bin 디렉터리에 존재한다.</p>

    <p>본 절에서는 C External Procedure를 생성하기에 앞서 먼저 <span>tbEPA</span>
    프로세스를 실행하기 위한 기본 환경을 설정하는 방법을 설명한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e529"/>3.1.1. 초기화 파라미터<a id="d5e531" class="indexterm"/></h3></div></div></div>
      

      <p><span>tbEPA</span> 프로세스는 처음 실행될 때 사용자가 설정한 초기화 파라미터를 먼저
      확인한다. 초기화 파라미터는 $<span>TB_</span>HOME/client/<span>tbepa</span>
      디렉터리의 <span>tbepa</span>.cfg 파일에서 설정할 수 있으며, 만약 설정한 초기화 파라미터가
      없으면 디폴트로 정의된 속성을 따르게 된다.<a id="d5e539" class="indexterm"/></p>

      <p><span>tbEPA</span> 프로세스의 실행과 관련하여 사용자가 설정할 수 있는 초기화 파라미터는
      다음과 같다.</p>

      <p>&lt;&lt;<span>tbepa</span>.cfg&gt;&gt;</p>

      <pre class="programlisting">LOG_DIR=/tmp/epa_log
LOG_LVL=2
MAX_LOG_SIZE=20k</pre>

      

      <div class="informaltable">
        <table border="1"><colgroup><col width="160" align="left"/><col/></colgroup><thead><tr><th align="left">초기화 파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left"><code class="filename">LOG_DIR</code><a id="d5e558" class="indexterm"/><a id="d5e560" class="indexterm"/></td><td><span>tbEPA</span> 로그 파일을 저장할 경로이다. (기본값: $<span>TB_</span>HOME/client/<span>tbepa</span>)</td></tr><tr><td align="left"><code class="filename">LOG_LVL</code><a id="d5e571" class="indexterm"/><a id="d5e573" class="indexterm"/></td><td>로그 파일에 남길 로그의 레벨이다. (기본값: 2)</td></tr><tr><td align="left"><code class="filename">MAX_LOG_SIZE</code><a id="d5e581" class="indexterm"/><a id="d5e583" class="indexterm"/></td><td><p>로그 파일의 최대 크기이다. (기본값: 0, 단위:
              Byte)</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>값이 0인 경우 : 로그 파일의 최대 크기를 설정하는 데 제한이 없다.</p>
                  </li><li style="list-style-type: circle">
                    <p>값을 명시한 경우 : 로그 파일이 설정된 최대 크기를 초과하면 로그 파일을
                    백업한다.</p>
                  </li></ul></div></td></tr><tr><td align="left"><code class="filename">MAX_LOG_BACKUP_SIZE</code><a id="d5e597" class="indexterm"/><a id="d5e599" class="indexterm"/></td><td><p>백업 디렉터리의 로그 파일들의 최대 크기이다. (기본값: 0, 단위:
              Byte)</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>값이 0인 경우 : 백업 디렉터리에 있는 로그 파일들의 크기의 합을 설정하는 데 제한이
                    없다.</p>
                  </li><li style="list-style-type: circle">
                    <p>값을 명시한 경우 : 백업 디렉터리에 있는 로그 파일들의 크기의 합이 설정된 최대 크기를
                    초과하는 경우, 가장 오래된 로그파일 1/3을 삭제한다.</p>
                  </li></ul></div></td></tr></tbody></table>
      </div>

      <div class="literallayout"><p/></div>

      <p><span>tbepa</span>.cfg 파일에서 초기화 파라미터
      <code class="filename">LOG_LVL</code>은 1부터 5 사이의 로그 레벨의 값을 설정할 수 있다.</p>

      <p>각 로그 레벨<a id="d5e615" class="indexterm"/>에 대한 설명은 다음과 같다.</p>

      <div class="informaltable">
        <table border="1"><colgroup><col width="110" align="left"/><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">로그 레벨</th><th align="left">로그 레벨명</th><th>설명</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">ERROR</td><td>에러와 관련된 이벤트이다.</td></tr><tr><td align="left">2</td><td align="left">WARNING</td><td>경고와 관련된 이벤트이다.</td></tr><tr><td align="left">3</td><td align="left">INFO</td><td>함수 호출 등과 관련된 기본적인 트레이스 이벤트이다.</td></tr><tr><td align="left">4</td><td align="left">DEBUG</td><td>디버깅을 위한 구체적인 트레이스 이벤트이다.</td></tr><tr><td align="left">5</td><td align="left">TRACE</td><td>매우 자세한 트레이스 이벤트이다.</td></tr></tbody></table>
      </div>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e648"/>3.2. 생성 절차</h2></div></div></div>
    

    <p>C External Procedure를 생성하기 위해서는 다음과 같은 세부 절차를 수행해야 한다.<a id="d5e651" class="indexterm"/></p>

    <div class="orderedlist"><ol type="1" compact="compact"><li>
        <p><a href="chapter_extproc_create.html#sect_user_shlib_create" title="3.2.1. 사용자 공유 라이브러리 생성">사용자 공유 라이브러리
        생성</a></p>
      </li><li>
        <p><a href="chapter_extproc_create.html#sect_lib_object_create" title="3.2.2. Library Object 등록">Library Object
        등록</a></p>
      </li><li>
        <p><a href="chapter_extproc_create.html#sect_user_func_psm" title="3.2.3. 사용자 함수를 PSM에 대응">사용자 함수를 PSM에 대응</a></p>
      </li><li>
        <p><a href="chapter_extproc_create.html#sect_user_func_exec" title="3.2.4. 사용자 함수 실행">사용자 함수 실행</a></p>
      </li></ol></div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_user_shlib_create"/>3.2.1. 사용자 공유 라이브러리 생성</h3></div></div></div>
      

      <p>C 프로그래밍 언어에서 동적으로 호출할 수 있는 사용자 공유 라이브러리를 생성한다.<a id="d5e669" class="indexterm"/></p>

      <p>생성하는 순서는 다음과 같다.</p>

      <div class="orderedlist"><ol type="1"><li>
          <p>C 함수를 작성한다.</p>

          <p>&lt;&lt;extproc.c&gt;&gt;</p>

          <pre class="programlisting">long find_max(long x, long y)
{
    if (x &gt;= y) return x; 
    else return y;
}</pre>
        </li><li>
          <p>컴파일을 수행한다.</p>

          <p>다음은 UNIX 계열(LINUX 포함)에서 컴파일을 수행하는 예이다.</p>

          <pre class="programlisting">cc -g -fpic -shared -o libextproc.so extproc.c</pre>
        </li><li>
          <p>컴파일이 완료되면, libextproc.so라는 사용자 공유 라이브러리가 생성된다.</p>
        </li></ol></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_lib_object_create"/>3.2.2. Library Object 등록<a id="d5e685" class="indexterm"/></h3></div></div></div>
      

      <p>Library Object는 사용자 공유 라이브러리 파일을 <span>Tibero</span>에 대응시키는 것으로 일종의 스키마 객체를 의미한다.</p>

      <p>Library Object를 등록하는 문법은 다음과 같다.<a id="d5e690" class="indexterm"/></p>

      <pre class="programlisting">CREATE LIBRARY [<span class="emphasis"><em>schema_name</em></span>.]<span class="emphasis"><em>library_name</em></span>
{IS | AS} '<span class="emphasis"><em>file_path</em></span>';</pre>

      <div class="informaltable">
        <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">항목</th><th>설명</th></tr></thead><tbody><tr><td align="left">schema_name</td><td>스키마 객체의 이름이다.</td></tr><tr><td align="left">library_name</td><td>Library Object의 이름이다.</td></tr><tr><td align="left">file_path</td><td>사용자 공유 라이브러리 파일이 존재하는 절대 경로이다.</td></tr></tbody></table>
      </div>

      <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
        <p>CREATE LIBRARY 문을 실행하려면, CREATE LIBRARY라는 권한이 필요하다.<a id="d5e715" class="indexterm"/></p>
      </div>

      <div class="literallayout"><p/></div>

      <p>다음은 생성한 사용자 공유 라이브러리 파일을 이용하여 'extproc'이라는 Library Object를 <span>Tibero</span>에 등록하는 예이다.</p>

      <pre class="programlisting">CREATE LIBRARY <span><strong class="guibutton">extproc</strong></span>
IS '/usr/mylib/<span><strong class="guibutton">libextproc.so</strong></span>';
/</pre>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_user_func_psm"/>3.2.3. 사용자 함수를 PSM에 대응</h3></div></div></div>
      

      <p>Library Object를 등록한 후 해당 Library Object 내의 특정 함수를 PSM 개체로 등록하면 C
      External Procedure를 생성할 수 있다. 사용자는 일반적인 PSM를 사용하는 인터페이스 그대로 함수를 호출할 수
      있다.</p>

      <p>다음은 일반적인 PSM를 선언하는 문법이다.<a id="d5e727" class="indexterm"/></p>

      <pre class="programlisting">CREATE OR REPLACE {FUCTION | PROCEDURE | PACKAGE}
…                                                   
{IS | AS}
LANGUAGE C
LIBRARY <span class="emphasis"><em>library_name</em></span>
[NAME <span class="emphasis"><em>c_string_literal_name</em></span>]
[WITH CONTEXT]
[PARAMETERS (external_parameter[, external_parameter]...)];</pre>

      <div class="informaltable">
        <table border="1"><colgroup><col width="230" align="left"/><col/></colgroup><thead><tr><th align="left">항목</th><th>설명</th></tr></thead><tbody><tr><td align="left"><span class="emphasis"><em>library_name</em></span></td><td>Library Object의 이름이다.</td></tr><tr><td align="left"><span class="emphasis"><em>c_string_literal_name</em></span></td><td>현재 PSM과 대응할 사용자 함수명이다.</td></tr><tr><td align="left">WITH CONTEXT</td><td>C External Procedure 유틸리티를 사용하고 있음을 명시할 때 사용한다. 자세한 내용은
              <a href="chapter_extproc_util.html" title="제5장 C External Procedure 유틸리티">“제5장 C External Procedure 유틸리티”</a>, <a href="sect_extproc_using.html#sect_callback_service" title="4.2. Callback Service">“4.2. Callback Service”</a>를 참고한다.</td></tr><tr><td align="left">PARAMETERS (external_parameter)</td><td>사용자 함수의 파라미터를 PSM 파라미터와 대응시킬 때 사용한다. external_parameter에
              대한 내용은 <a href="sect_extproc_using.html#sect_parameter_mapping" title="4.1. 파라미터 매핑">“4.1. 파라미터 매핑”</a>을 참고한다.</td></tr></tbody></table>
      </div>

      <div class="literallayout"><p/></div>

      <p>다음은 Library Object 내의 특정 함수(find_max)를 PSM에 대응하는 예이다.</p>

      <pre class="programlisting">CREATE OR REPLACE FUNCTION <span><strong class="guibutton">ext_find_max(num1 BINARY_INTEGER, num2 BINARY_INTEGER)</strong></span>
  RETURN BINARY_INTEGER
  AS LANGUAGE C
  LIBRARY <span><strong class="guibutton">extproc</strong></span>
  NAME "find_max"
  PARAMETERS(num1 int, num2 int);</pre>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_user_func_exec"/>3.2.4. 사용자 함수 실행</h3></div></div></div>
      

      <p>사용자 함수는 <span>Tibero</span>상의 하나의 PSM에 대응되므로, PSM의 문법을 사용할 수
      있다.</p>

      <p>다음은 PSM의 문법을 이용하여 C External Procedure를 실행하는 예이다.</p>

      <pre class="programlisting">SQL&gt; CREATE TABLE TBL (COL1 NUMBER, COL2 NUMBER);
Table 'TBL' created.

SQL&gt; INSERT INTO TBL VALUES(1, 2);
1 row inserted.

SQL&gt; INSERT INTO TBL VALUES(5, 3);
1 row inserted.

SQL&gt; INSERT INTO TBL VALUES(7, 9);
1 row inserted.

SQL&gt; select col1, col2, <span><strong class="guibutton">ext_find_max(col1, col2)</strong></span> as max from tbl;
      col1       col2        max
---------- ---------- ----------
         1          2          2
         5          3          5
         7          9          9

3 rows selected.</pre>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chapter_extproc.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="sect_extproc_using.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제2장 C External Procedure </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제4장 C External Procedure 사용</td></tr></table></div><div xmlns="" align="center"/></body></html>