<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제7장 Java External Procedure 생성</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero External Procedure 안내서"/><link rel="up" href="index.html" title="Tibero External Procedure 안내서"/><link rel="prev" href="chapter_java_extproc.html" title="제6장 Java External Procedure"/><link rel="next" href="chapter_java_extproc_using.html" title="제8장 Java External Procedure 사용"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제7장 Java External Procedure 생성</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chapter_java_extproc.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="chapter_java_extproc_using.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chapter_java_extproc_create"/>제7장 Java External Procedure 생성</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chapter_java_extproc_create.html#d5e1314">7.1. 기본 환경설정</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_java_extproc_create.html#d5e1317">7.1.1. 초기화 파라미터</a></span></dt><dt><span class="section"><a href="chapter_java_extproc_create.html#d5e1367">7.1.2. JEPA 연결정보</a></span></dt><dt><span class="section"><a href="chapter_java_extproc_create.html#d5e1382">7.1.3. JEPA 환경설정</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_java_extproc_create.html#d5e1455">7.2. Java External Procedure 생성</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_java_extproc_create.html#sect_java_obj_create">7.2.1. Java 객체 생성</a></span></dt><dt><span class="section"><a href="chapter_java_extproc_create.html#sect_java_object_compile">7.2.2. 생성된 Java 객체 컴파일</a></span></dt><dt><span class="section"><a href="chapter_java_extproc_create.html#sect_psm_func_create">7.2.3. PSM 함수 생성</a></span></dt><dt><span class="section"><a href="chapter_java_extproc_create.html#sect_java_class_exec">7.2.4. Java 클래스 실행</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 Java External Procedure를 생성하는 절차를 기본 환경설정과 생성 단계로 나누어
  설명한다.</p>

  <p/>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e1314"/>7.1. 기본 환경설정</h2></div></div></div>
    

    <p>본 절에서는 Java External Procedure를 생성하기에 앞서 기본 환경을 설정하는 방법을
    설명한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1317"/>7.1.1. 초기화 파라미터<a id="d5e1319" class="indexterm"/></h3></div></div></div>
      

      <p>JEPA 프로세스의 실행과 관련하여 사용자가 설정할 수 있는 초기화 파라미터는 다음과 같다.<a id="d5e1322" class="indexterm"/></p>

      <p>&lt;&lt;$<span>TB_</span>SID.tip&gt;&gt;</p>

      <pre class="programlisting">_PSM_BOOT_JEPA=Y
JAVA_CLASS_PATH=/home/<span>tibero</span>/<span>tibero</span>7/instance/<span>tibero</span>/java</pre>

      <div class="informaltable">
        <table border="1"><colgroup><col width="130" align="left"/><col/></colgroup><thead><tr><th align="left">초기화 파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left"><code class="filename">_PSM_BOOT_JEPA</code><a id="d5e1342" class="indexterm"/><a id="d5e1344" class="indexterm"/></td><td><p>JEPA 프로세스의 기동 여부를 설정한다.</p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>Y : JEPA 프로세스를 기동하기 위해서는 반드시 이 초기화 파라미터에
                    '<span><strong class="guibutton">Y'</strong></span>를 설정해야 한다.</p>
                  </li><li style="list-style-type: circle">
                    <p>N : 데이터베이스 서버는 기동이 되지만, JEPA 프로세스는 기동되지 않는다.</p>
                  </li></ul></div></td></tr><tr><td align="left"><code class="filename">JAVA_CLASS_PATH</code><a id="d5e1358" class="indexterm"/><a id="d5e1360" class="indexterm"/></td><td><p>사용자가 Java 객체를 생성할 때 컴파일 경로로 사용된다.</p><p>이 항목이
              설정되어 있지 않으면, <code class="filename">DB_CREATE_FILE_DEST</code> 초기화 파라미터에
              설정된 경로의 하위 디렉터리 Java에 클래스 파일이 생성된다.</p></td></tr></tbody></table>
      </div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1367"/>7.1.2. JEPA 연결정보<a id="d5e1369" class="indexterm"/></h3></div></div></div>
      

      <p>$<span>TB_</span>HOME/client/config 디렉터리에 위치한 <span>tbdsn</span>.tbr 파일에 JEPA 프로세스의 접속 정보를 설정한다.</p>

      <p>다음은 <span>tbdsn</span>.tbr 파일에 설정된 접속 정보의 예이다.</p>

      <p>&lt;&lt;<span>tbdsn</span>.tbr&gt;&gt;</p>

      <pre class="programlisting"><span><strong class="guibutton">epa</strong></span>=(
      (EXTPROC=(LANG=JAVA)
               (LISTENER=(HOST=localhost)
                         (PORT=9390)
               )
      )
    )     </pre>

      <p><span>Tibero</span> 서버는 접속 정보를 이용하여 JEPA 프로세스에
      연결한다.</p>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1382"/>7.1.3. JEPA 환경설정<a id="d5e1384" class="indexterm"/></h3></div></div></div>
      

      <p>$<span>TB_</span>HOME/client/epa/java/config 디렉터리에 위치한
      epa.cfg 파일을 사용자의 시스템 환경에 맞게 수정한다. 환경설정이 적용되면 Java External Procedure를
      생성할 준비가 모두 완료된다.</p>

      <p>다음은 epa.cfg 파일을 설정한 예이다.<a id="d5e1389" class="indexterm"/></p>

      <p>&lt;&lt;epa.cfg&gt;&gt;</p>

      <pre class="programlisting"># listener port
LISTENER_PORT=9390

# initial thread pool size
INIT_POOL_SIZE=10

# max thread pool size
MAX_POOL_SIZE=1000

# gateway encoding "ASCII", "EUC-KR", "MSWIN949", "UTF-8", "UTF-16", "SHIFT-JIS"
ENCODING=MSWIN949

#STATIC_LOADING_CLASSES=ex.StaticClass1, ex.st.Class2</pre>

      <div class="informaltable">
        <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">초기화 파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left"><code class="filename">LISTENER_PORT</code><a id="d5e1404" class="indexterm"/><a id="d5e1406" class="indexterm"/></td><td><span>tbdsn</span>.tbr 파일에 설정한 포트 번호와 동일하게
              설정한다.</td></tr><tr><td align="left"><code class="filename">INIT_POOL_SIZE</code><a id="d5e1414" class="indexterm"/><a id="d5e1416" class="indexterm"/></td><td>JEPA 프로세스가 기동할 때 처음으로 생성하는 스레드의 개수이다.</td></tr><tr><td align="left"><code class="filename">MAX_POOL_SIZE</code><a id="d5e1423" class="indexterm"/><a id="d5e1425" class="indexterm"/></td><td>JEPA 프로세스가 생성할 수 있는 최대 스레드의 개수이다.</td></tr><tr><td align="left"><code class="filename">ENCODING</code><a id="d5e1432" class="indexterm"/><a id="d5e1434" class="indexterm"/></td><td>JEPA 프로세스에서 사용할 인코딩 방식이다. 단, 데이터베이스 서버와 동기화를 위해서 반드시 서로
              같은 인코딩을 사용해야 한다.</td></tr><tr><td align="left"><code class="filename">STATIC_LOADING_CLASSES</code><a id="d5e1441" class="indexterm"/><a id="d5e1443" class="indexterm"/></td><td>JNI를 사용하는 library와 같이 Dynamic Class Loading하기에 적합하지 않은
              클래스 라이브러리를 사용할 경우에 필요한 파라미터이다.</td></tr></tbody></table>
      </div>

      <p/>

      <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
          <p><span>tbdsn</span>.tbr 파일과 epa.cfg 파일에 있는 포트 번호는 반드시
          일치해야 한다.</p>
        </div>

      <p/>

      <p/>

      <p/>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e1455"/>7.2. Java External Procedure 생성</h2></div></div></div>
    

    <p>Java External Procedure를 생성하기 위해서는 다음과 같은 세부 절차를 수행해야 한다.<a id="d5e1458" class="indexterm"/></p>

    <div class="orderedlist"><ol type="1" compact="compact"><li>
        <p><a href="chapter_java_extproc_create.html#sect_java_obj_create" title="7.2.1. Java 객체 생성">Java 객체의 생성</a></p>
      </li><li>
        <p><a href="chapter_java_extproc_create.html#sect_java_object_compile" title="7.2.2. 생성된 Java 객체 컴파일">생성된 Java 객체를
        컴파일</a></p>
      </li><li>
        <p><a href="chapter_java_extproc_create.html#sect_psm_func_create" title="7.2.3. PSM 함수 생성">PSM 함수의 생성</a></p>
      </li><li>
        <p><a href="chapter_java_extproc_create.html#sect_java_class_exec" title="7.2.4. Java 클래스 실행">Java 클래스의 실행</a></p>
      </li></ol></div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_java_obj_create"/>7.2.1. Java 객체 생성</h3></div></div></div>
      

      <p>Java External Procedure를 생성하기 위해서는 먼저 Java에서 동적으로 호출할 수 있는 형태의 사용자
      Java 클래스를 DBMS에 등록해야 한다. 즉, 사용자 Java 클래스를 하나의 데이터베이스 객체로 등록하는 과정이다. 이
      과정을 통해 PSM 개체 하나와 사용자 Java 클래스를 대응시키면 기존의 PSM을 호출하는 것과 똑같은 인터페이스로
      <span><strong class="guibutton">사용자 Java 클래스</strong></span>를 사용할 수 있다.</p>

      <div class="literallayout"><p/></div>

      <p>다음은 Java 객체를 생성하는 예이다.<a id="d5e1479" class="indexterm"/></p>

      <pre class="programlisting">SQL&gt; CREATE OR REPLACE AND RESOLVE JAVA SOURCE NAMED "JavaExtproc" AS
     public class SimpleMath {
         public static int findMax(int x, int y) {
             if (x &gt;= y) return x;
             else return y;
         }
     }
     /<span><strong class="guibutton">

Java Source 'JavaExtproc' created.</strong></span>

SQL&gt;</pre>

      <p>위와 같은 DDL 문장을 실행하면, 데이터베이스에는 <span><strong class="guibutton">JavaExtproc</strong></span>라는
      Java 객체가 생성된다. 생성된 Java 객체를 보려면 USER_OBJECTS 뷰나 LS 명령어를 이용하여 조회할 수
      있다.</p>

      <p>다음은 LS 명령어를 이용하여 생성된 Java 객체를 조회하는 예이다.</p>

      <pre class="programlisting">SQL&gt; LS

NAME                                                      OBJECT_TYPE
--------------------------------------------------------- -------------------
JavaExtproc                                               JAVA

1 row selected.

SQL&gt;</pre>

      <div class="caution" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">주의</h3>
        <p>Java External Procedure에서 Java 객체를 호출할 때 빈 생성자(nullary
        constructor)를 호출하기 때문에 생성자를 생략하거나 다른 생성자(constructor)를 사용할 경우 반드시 빈
        생성자(nullary constructor)를 명시해줘야 한다.</p>
      </div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_java_object_compile"/>7.2.2. 생성된 Java 객체 컴파일</h3></div></div></div>
      

      <p>DDL 문장으로 작성된 Java 객체의 소스 코드는 별도의 파일로 생성되며,
      <code class="filename">JAVA_CLASS_PATH</code> 초기화 파라미터에 설정된 경로에 저장된다. Java 객체를
      패키지로 생성할 경우 디폴트 저장 경로에 패키지 경로를 생성하여 클래스 파일 형태로 저장한다.</p>

      <p>예를 들면 다음과 같다.</p>

      <pre class="programlisting">SQL&gt; CREATE OR REPLACE AND RESOLVE JAVA SOURCE NAMED "JavaExtproc" AS
     package com.<span>tmax</span>;
     public class SimpleMath {
         public static int findMax(int x, int y) {
             if (x &gt;= y) return x;
             else return y;
        }
     } </pre>

      <p>위 문장을 실행하면 최종적으로 JAVA_CLASS_PATH/com/<span>tmax</span> 디렉터리에
      <span><strong class="guibutton">SimpleMath.class</strong></span> 파일이 생성된다. 생성된 클래스 파일은 외부 Java
      컴파일러를 이용하여 컴파일한다.</p>

      <div class="literallayout"><p/></div>

      <p>외부 Java 컴파일러는 $<span>TB_</span>HOME/bin 디렉터리에 있는
      <span><strong class="guibutton">psmjavac</strong></span> 스크립트를 사용할 수 있다.<a id="d5e1503" class="indexterm"/></p>

      <p>psmjavac 스크립트를 사용하여 실제 컴파일 명령어를 수행하는 문법은 다음과 같다.</p>

      <pre class="programlisting">javac -classpath ${classpath} ${src}</pre>

      <div class="informaltable">
        <table border="1"><colgroup><col width="120" align="left"/><col/></colgroup><thead><tr><th align="left">항목</th><th>설명</th></tr></thead><tbody><tr><td align="left">classpath</td><td><code class="filename">JAVA_CLASS_PATH </code>초기화 파라미터에 설정된 경로와
              <span><strong class="guibutton">$<span>TB_</span>HOME/client/lib/jar/<span>tibero</span>7-jdbc.jar</strong></span> 경로가
              기본적으로 포함된다.</td></tr><tr><td align="left">src</td><td>컴파일을 수행할 Java 소스 코드이다.</td></tr></tbody></table>
      </div>

      <div class="literallayout"><p/></div>

      <p>별도의 외부 라이브러리를 사용하여 Java 객체를 생성할 경우 psmjavac 스크립트 파일을 수정한다.</p>

      <p>예를 들어 JVM에서 제공하는 htmlconverter.jar를 사용하는 Java 객체를 생성할 경우에는 다음과 같은
      명령어를 수행한다.</p>

      <pre class="programlisting">javac -classpath ${classpath}:$JAVA_HOME/lib ${src}</pre>

      <div class="literallayout"><p/></div>

      <p>JEPA가 별도의 VM으로 실행되기 때문에 외부 라이브러리를 사용한 객체를 침조하는 PSM 함수를 호출하는 경우
      JEPA에서도 해당 라이브러리를 참조하고 있어야 한다. JEPA는 $<span>TB_</span>HOME/client/bin 디렉터리에 있는 <span>tbjavaepa</span> 스크립트에 의해 실행되는데, 다음 exec java 명령 문장의
      -classpath 옵션에도 라이브러리의 경로를 추가한다.</p>

      <pre class="programlisting">exec java -verbose:gc -Xms128m -Xmx512m -D<span>javaepa</span>="$<span>TB_</span>HOME"
      -Dlog4j.configuration=$log4jfile
      -classpath $pool:$collections:$log4j:
       $:$:$config $mainclass CONFIG=$configfile</pre>

      <div class="literallayout"><p/></div>

      <p>Java 객체를 삭제하기 위해서는 다음과 같은 명령을 사용해야 한다.</p>

      <pre class="programlisting">SQL&gt; DROP JAVA SOURCE "JavaExtproc";
Java Source 'JavaExtproc' dropped.

SQL&gt;</pre>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_psm_func_create"/>7.2.3. PSM 함수 생성</h3></div></div></div>
      

      <p>CREATE JAVA 문장을 실행하려면 <span><strong class="guibutton">CREATE PROCEDURE</strong></span> 권한이
      필요하다.<a id="d5e1543" class="indexterm"/></p>

      <p>Java 객체를 다음 예처럼 PSM과 대응시키는 과정을 거치고 나면 PSM 프로그램의 인터페이스를 그대로 사용할 수
      있다.</p>

      <pre class="programlisting">SQL&gt; CREATE OR REPLACE FUNCTION find_max(x PLS_INTEGER, y PLS_INTEGER)
     RETURN PLS_INTEGER IS
     LANGUAGE JAVA NAME '<span><strong class="guibutton">SimpleMath.findMax(int, int) return int</strong></span>';
     /

Function 'FIND_MAX' created.

SQL&gt;</pre>

      <div class="literallayout"><p/></div>

      <p>PSM 함수를 생성하는 문장에서 PSM과 Java 사이에서 변환하거나 사용할 수 있는 타입은 다음과
      같다.<a id="d5e1550" class="indexterm"/></p>

      <div class="informaltable">
        <table border="1"><colgroup><col width="200" align="left"/><col/></colgroup><thead><tr><th align="left">PSM의 타입</th><th>Java의 타입</th></tr></thead><tbody><tr><td align="left"><p>CHAR, LONG, VARCHAR2</p></td><td><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>java.lang.String</p>
                  </li><li style="list-style-type: circle">
                    <p>java.sql.Date</p>
                  </li><li style="list-style-type: circle">
                    <p>java.sql.Time</p>
                  </li><li style="list-style-type: circle">
                    <p>java.sql.Timestamp</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Byte</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Short</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Integer</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Long</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Float</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Double</p>
                  </li><li style="list-style-type: circle">
                    <p>java.math.BigDecimal</p>
                  </li><li style="list-style-type: circle">
                    <p>byte</p>
                  </li><li style="list-style-type: circle">
                    <p>short</p>
                  </li><li style="list-style-type: circle">
                    <p>int</p>
                  </li><li style="list-style-type: circle">
                    <p>long</p>
                  </li><li style="list-style-type: circle">
                    <p>float</p>
                  </li><li style="list-style-type: circle">
                    <p>double</p>
                  </li></ul></div></td></tr><tr><td align="left"><p>DATE</p></td><td><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>java.sql.Date</p>
                  </li><li style="list-style-type: circle">
                    <p>java.sql.Time</p>
                  </li><li style="list-style-type: circle">
                    <p>java.sql.Timestamp</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.String</p>
                  </li></ul></div></td></tr><tr><td align="left"><p>NUMBER</p></td><td><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                    <p>java.lang.Byte</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Short</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Integer</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Long</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Float</p>
                  </li><li style="list-style-type: circle">
                    <p>java.lang.Double</p>
                  </li><li style="list-style-type: circle">
                    <p>java.math.BigDecimal</p>
                  </li><li style="list-style-type: circle">
                    <p>byte</p>
                  </li><li style="list-style-type: circle">
                    <p>short</p>
                  </li><li style="list-style-type: circle">
                    <p>int</p>
                  </li><li style="list-style-type: circle">
                    <p>long</p>
                  </li><li style="list-style-type: circle">
                    <p>float</p>
                  </li><li style="list-style-type: circle">
                    <p>double</p>
                  </li></ul></div></td></tr><tr><td align="left">RAW, LONG RAW</td><td><div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle">
                    <p>byte[ ]</p>
                  </li></ul></div></td></tr><tr><td align="left">ROWID</td><td><div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle">
                    <p>java.lang.String</p>
                  </li></ul></div></td></tr></tbody></table>
      </div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_java_class_exec"/>7.2.4. Java 클래스 실행</h3></div></div></div>
      

      <p>PSM 함수는 SQL 문장을 실행하는 것과 동일한 방법으로 실행할 수 있다.</p>

      <p>다음은 SQL 문장에서 PSM 함수를 실행하는 예이다.</p>

      <pre class="programlisting">SQL&gt; select find_max(4,60) from dual;

FIND_MAX(4,60)
--------------
            60

1 row selected.

SQL&gt;</pre>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chapter_java_extproc.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="chapter_java_extproc_using.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제6장 Java External Procedure </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제8장 Java External Procedure 사용</td></tr></table></div><div xmlns="" align="center"/></body></html>