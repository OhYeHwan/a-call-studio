<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제3장 트리거의 사용</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero 애플리케이션 개발자 안내서"/><link rel="up" href="index.html" title="Tibero 애플리케이션 개발자 안내서"/><link rel="prev" href="ch02.html" title="제2장 tbJDBC의 사용"/><link rel="next" href="ch04.html" title="제4장 XA의 사용"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제3장 트리거의 사용</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="ch04.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="d5e1323"/>제3장 트리거의 사용</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="ch03.html#d5e1326">3.1. 개요</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d5e1333">3.1.1. 트리거 구성요소</a></span></dt><dt><span class="section"><a href="ch03.html#d5e1357">3.1.2. 트리거 타입</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d5e1396">3.2. 트리거 생성</a></span></dt></dl></div>
  

  <p>본 장에서는 트리거의 기본 개념과 이를 생성하는 방법을 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e1326"/>3.1. 개요<a id="d5e1328" class="indexterm"/></h2></div></div></div>
    

    <p><span><strong class="guibutton">트리거</strong></span>(Trigger)는 스키마 객체의 일종으로, 데이터베이스가 미리 정해 놓은
    특정 조건이 만족되거나 어떤 동작이 수행되면 자동으로 실행되도록 정의한 동작이다. 예를 들어 데이터베이스에 특정한 이벤트가 발생되거나
    사용자가 설정한 DDL 문장이 수행될 때 트리거가 실행될 수 있다.</p>

    <p>트리거의 내용은 PSM으로 이루어져 있다. 트리거는 이미 정의된 PSM 객체를 호출하여 사용하거나 트리거를 생성할 때 이름
    없는 블록을 함께 선언해주는 방식을 모두 이용할 수 있다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1333"/>3.1.1. 트리거 구성요소</h3></div></div></div>
      

      <p>트리거는 다음과 같은 세 가지 구성요소를 갖춰야만 생성할 수 있다.<a id="d5e1336" class="indexterm"/></p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>트리거가 실행될 조건이 되는 문장이나 이벤트</p>
        </li><li>
          <p>실행 조건의 제약</p>
        </li><li>
          <p>실행될 내용</p>
        </li></ul></div>

      <div class="literallayout"><p/></div>

      <p>다음은 <span><strong class="guibutton">alarm_for_balance</strong></span>라는 트리거를 생성하는
      예이다.</p>

      <pre class="programlisting">CREATE OR REPLACE TRIGGER alarm_for_balance
BEFORE INSERT OR UPDATE ON balance_tab        <em class="lineannotation"><span class="lineannotation">... ⓐ ...</span></em>
FOR EACH ROW
WHEN (new.balance &lt; 3000)                     <em class="lineannotation"><span class="lineannotation">..  ⓑ ...</span></em>
    CALL alarm_for_balance_fn()               <em class="lineannotation"><span class="lineannotation">..  ⓒ ...</span></em></pre>

      <p>ⓐ 테이블 balance_tab의 balance 컬럼에 로우가 삽입되거나 수정이 발생했을 때 ⓑ로
      이동한다.</p>

      <p>ⓑ 해당 로우의 값이 3000 이하인지를 검사한다.</p>

      <p>ⓒ 검사한 결과가 맞으면 <code class="function">alarm_for_balance_fn</code> 함수를 호출하고,
      함수에 정의한 동작이 실행된다.</p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e1357"/>3.1.2. 트리거 타입<a id="d5e1359" class="indexterm"/></h3></div></div></div>
      

      <p>트리거의 타입은 다음과 같이 나눌 수 있다.</p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>로우(row) 및 문장(statement)</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="120" align="left"/><col/></colgroup><thead><tr><th align="left">타입</th><th>설명</th></tr></thead><tbody><tr><td align="left">로우</td><td>테이블에 INSERT, UPDATE, DELETE가 발생하는 로우마다 트리거의 내용이 실행되는
                  타입이다. 이 타입의 트리거는 각 로우에 연산이 발생할 때마다 연산 직전 또는 직후에 트리거가
                  실행된다.</td></tr><tr><td align="left">문장</td><td>로우의 개수에 상관없이 문장 단위로 한 번만 실행되는 타입이다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>BEFORE 및 AFTER</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="120" align="left"/><col/></colgroup><thead><tr><th align="left">타입</th><th>설명</th></tr></thead><tbody><tr><td align="left">BEFORE</td><td>조건 문장이 실행되기 전에 트리거의 내용이 실행되는 타입이다.</td></tr><tr><td align="left">AFTER</td><td>조건 문장이 실행된 후 트리거의 내용이 실행되는 타입이다.</td></tr></tbody></table>
          </div>

          <p>트리거는 두 종류의 타입 중에서 하나씩을 각각 가질 수 있다. 즉, BEFORE 로우(BEFORE row),
          BEFORE 문장(BEFORE statement), AFTER 로우(AFTER row), AFTER 문장(AFTER
          statement)의 타입으로 생성할 수 있다.</p>
        </li></ul></div>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e1396"/>3.2. 트리거 생성<a id="d5e1398" class="indexterm"/></h2></div></div></div>
    

    <p>트리거를 생성하는 방법은 다음과 같다.</p>

    <pre class="programlisting">CREATE [OR REPLACE] TRIGGER 트리거_이름
      {BEFORE | AFTER} {INSERT | UPDATE | DELETE} ON 테이블_이름
      [FOR EACH ROW]
WHEN (조건_제약)
    {[선언부]
BEGIN
     ...
END;} | 
CALL 함수_또는_프러시저_이름</pre>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
      <p>트리거의 문법에 대한 자세한 내용은 "<span>Tibero</span> SQL 참조
      안내서"를 참고한다.</p>
    </div>

    <div class="literallayout"><p/></div>

    <p>다음은 로우 타입의 트리거로, 테이블 DECK_TBL의 COUNT 컬럼에 로우 값이 1000을 초과할 때마다 로그를
    기록하도록 작성한 예이다.</p>

    <div class="example"><a id="d5e1407"/><p class="title"><b>[예 3.1] 트리거의 생성</b></p><div class="example-contents">
      

      

      <pre class="programlisting"><span><strong class="guibutton">CREATE OR REPLACE TRIGGER Log_overflow</strong></span>
AFTER UPDATE ON Deck_tbl
FOR EACH ROW
WHEN (new.count &gt; 1000)
BEGIN
    INSERT 
    INTO Deck_log (Deck_id, Timestamp, New_count, Action)
    VALUES (:new.Deck_no, SYSTIMESTAMP, :new.count, 'overflow');
END;</pre>
    </div></div><br class="example-break"/>

    <p>CREATE 문장은 <span>Tibero</span> 내부에서는 BEGIN – END 사이의 부분을 PSM으로 인식한다. 이 문장이 컴파일 되면 PSM
    스키마 객체가 생성되고 이를 데이터베이스에 저장한다. 만약 컴파일 에러가 발생한다면 정적 뷰를 통해 에러의 내용을 확인할 수
    있다.</p>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch04.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제2장 <span>tbJDBC</span>의 사용 </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제4장 XA의 사용</td></tr></table></div><div xmlns="" align="center"/></body></html>