<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제7장 컬렉션 타입의 사용</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero 애플리케이션 개발자 안내서"/><link rel="up" href="index.html" title="Tibero 애플리케이션 개발자 안내서"/><link rel="prev" href="chapter_object_type.html" title="제6장 객체 타입의 사용"/><link rel="next" href="appendix_a.html" title="Appendix A. tbJDBC 예제"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제7장 컬렉션 타입의 사용</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chapter_object_type.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="appendix_a.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chapter_collection_type"/>제7장 컬렉션 타입의 사용</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chapter_collection_type.html#d5e2925">7.1. 개요</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_collection_type.html#d5e2946">7.1.1. 컬렉션 타입 생성</a></span></dt><dt><span class="section"><a href="chapter_collection_type.html#d5e2960">7.1.2. 컬렉션(컬렉션 값) 생성</a></span></dt><dt><span class="section"><a href="chapter_collection_type.html#d5e2973">7.1.3. 다층 컬렉션 타입</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_collection_type.html#d5e2987">7.2. 사용 예제</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_collection_type.html#d5e2991">7.2.1. 쿼리에서 사용</a></span></dt><dt><span class="section"><a href="chapter_collection_type.html#d5e3024">7.2.2. DML에서 사용</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 <span>Tibero</span>의 컬렉션 타입과 사용방법에 대해서 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e2925"/>7.1. 개요<a id="d5e2927" class="indexterm"/></h2></div></div></div>
    

    <p>컬렉션 타입은 같은 타입의 값들을 모아 두기 위해 정의할 수 있는 사용자 정의 타입의 한 종류이다.</p>

    <p>다음의 두 가지 형태 중 하나로 존재한다.</p>

    <div class="itemizedlist"><ul type="disc" compact="compact"><li>
        <p><span><strong class="guibutton">가변 배열</strong></span>은 순서가 있는 같은 타입의 요소들의 모음이다.<a id="d5e2935" class="indexterm"/></p>
      </li><li>
        <p><span><strong class="guibutton">중첩 테이블</strong></span>은 갯수의 제한이 없는 순서가 정해지지 않은 같은 타입의
        요소들의 모음이다.<a id="d5e2940" class="indexterm"/></p>
      </li></ul></div>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
        <p>현재 중첩 테이블은 PSM 내에서만 사용이 가능하다.</p>
      </div>

    <p/>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2946"/>7.1.1. 컬렉션 타입 생성<a id="d5e2948" class="indexterm"/></h3></div></div></div>
      

      <p><span><strong class="guibutton">CREATE TYPE 문</strong></span>을 사용해 컬렉션 타입을 생성한다. <a id="d5e2952" class="indexterm"/></p>

      <p>가변 배열 타입을 생성하기 위해서는 다음과 같이 AS VARRAY를 명시한다. VARRAY 다음에 오는 괄호 안에 이
      가변 배열이 담을 수 있는 요소 갯수의 최대값을 입력한다. OF 뒤에 오는 요소 타입으로는 내장 타입 또는 사용자 정의 타입의
      이름을 명시할 수 있다.</p>

      <div class="example"><a id="d5e2955"/><p class="title"><b>[예 7.1] 컬렉션 타입 생성</b></p><div class="example-contents">
        

        

        <pre class="programlisting">CREATE TYPE str_varr_type AS VARRAY(10000) OF VARCHAR(100);
/</pre>
      </div></div><br class="example-break"/>

      <p>컬렉션 타입 생성은 객체 타입 생성과 마찬가지로 실제 컬렉션을 저장하기 위한 공간을 할당하는 것이 아니며 컬렉션의
      모양만을 기술할 뿐이다. LOB 타입 그리고 XMLType들에 대한 가변 배열은 생성할 수 없다. 컬렉션 타입은 테이블의 컬럼
      타입, 객체 타입의 속성 타입, PSM 내에서의 변수 및 매개변수 그리고 반환값의 타입으로써 사용될 수 있다. 객체 테이블의
      타입으로는 사용이 할 수 없다. </p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2960"/>7.1.2. 컬렉션(컬렉션 값) 생성<a id="d5e2962" class="indexterm"/></h3></div></div></div>
      

      <p>컬렉션(컬렉션 값)을 생성하기 위해서는 컬렉션 타입의 이름 다음에 괄호 안에 해당 컬렉션 타입의 요소들을 콤마(,)와
      함께 나열하여 생성할 수 있다.</p>

      <div class="example"><a id="d5e2965"/><p class="title"><b>[예 7.2] 컬렉션(컬렉션 값) 생성</b></p><div class="example-contents">
        

        

        <pre class="programlisting">str_varr_type('ABC', 'DEFG', 'HH')
str_varr_type()</pre>
      </div></div><br class="example-break"/>

      <p>괄호 안에 어떤 요소 값도 주지 않은 채로 컬렉션을 생성할 때 이것을 <span><strong class="guibutton">빈
      컬렉션</strong></span>이라고 한다. 빈 컬렉션은 컬렉션에 참여하는 요소만 없을 뿐 NULL은 아니다.<a id="d5e2970" class="indexterm"/></p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2973"/>7.1.3. 다층 컬렉션 타입<a id="d5e2975" class="indexterm"/></h3></div></div></div>
      

      <p>컬렉션 타입의 요소의 타입이 또 다른 컬렉션 타입이거나, 요소의 타입이 객체 타입이고 이 객체 타입의 요소 중 하나가
      컬렉션 타입일 경우 이것을 다층 컬렉션 타입이라고 한다. <span><strong class="guibutton">현재 SQL 쿼리에서는 가변 배열로만 다층 컬렉션
      타입의 구성이 가능하며 중첩 테이블과 가변 배열을 섞어서 다층 컬렉션 타입을 구성할 수는 없다.</strong></span></p>

      <p>컬렉션 타입을 사용할 수 있는 곳이라면 다층 컬렉션 타입도 사용이 가능하다. 다층 컬렉션(컬렉션 값)을 생성할 때도
      일반 컬렉션과 마찬가지 방식으로 요소들을 명시하는데, 결국 이것은 다음과 같이 컬렉션 타입 이름을 중첩해서 명시한다.</p>

      <div class="example"><a id="d5e2980"/><p class="title"><b>[예 7.3] 다층 컬렉션 타입</b></p><div class="example-contents">
        

        <pre class="programlisting">CREATE OR REPLACE TYPE str_varr_coll_type AS VARRAY(1000) OF str_varr_type;
/

CREATE TABLE nested_coll_tbl (id number, coll_val str_varr_coll_type);

INSERT INTO nested_coll_tbl VALUES (1,
  str_varr_coll_type(str_varr_type('AB', 'CD'), str_varr_type()));
INSERT INTO nested_coll_tbl VALUES (2,
  str_varr_coll_type(str_varr_type(), str_varr_type('EF', 'GH')));</pre>

        <p/>

        <p/>

        <p/>
      </div></div><br class="example-break"/>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e2987"/>7.2. 사용 예제</h2></div></div></div>
    

    <p>본 절에서는 컬렉션 타입을 사용하는 경우에 따른 사용법을 설명한다.</p>

    <p/>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2991"/>7.2.1. 쿼리에서 사용</h3></div></div></div>
      

      <p>현재 SELECT의 결과 컬럼을 컬렉션으로 하여 컬렉션 내용을 클라이언트로 전달하는 기능은 구현되어 있지 않다. 그러나
      TABLE() 표현식을 사용해서 컬렉션을 풀어헤치면 SELECT 쿼리에서도 컬렉션의 내용을 조회할 수가 있다. TABLE()
      표현식은 FROM 절에 사용하여 컬렉션의 각 요소를 행으로 바꾼 테이블처럼 사용할 수 있도록 하는 표현식이다.</p>

      <div class="example"><a id="d5e2994"/><p class="title"><b>[예 7.4] 쿼리에서의 컬렉션 타입 사용</b></p><div class="example-contents">
        

        

        <pre class="programlisting">CREATE TABLE coll_tbl (id number, coll_val str_varr_type);

INSERT INTO coll_tbl VALUES (1, str_varr_type('AB', 'CD'));
INSERT INTO coll_tbl VALUES (2, str_varr_type('EF', 'GH'));
INSERT INTO coll_tbl VALUES (3, str_varr_type());

SQL&gt; SELECT id, d.* FROM coll_tbl c, TABLE(c.coll_val) d;

        ID COLUMN_VALUE
---------- ------------
         1 AB
         1 CD
         2 EF
         2 GH

4 rows selected.</pre>
      </div></div><br class="example-break"/>

      <p>TABLE() 표현식의 인자로 공급되는 컬럼은 FROM 절에서 자신의 왼쪽에 있는 테이블의 컬럼 중 컬렉션 타입의
      컬럼을 명시할 수 있다(이를 위해 일반적으로 위와 같이 테이블 별칭을 사용한다). 위에서 보는 것처럼 내장 타입 혹은 컬렉션에
      대한 컬렉션일 경우 TABLE() 표현식으로 인해 만들어지는 테이블은 COLUMN_VALUE라고 하는 하나의 컬럼만을
      가진다.</p>

      <div class="literallayout"><p/></div>

      <p>TABLE() 표현식에 대해서는 다음과 같이 외부 조인 연산자인 (+)로 외부 조인을 수행시킬 수 있다.</p>

      <div class="example"><a id="d5e3000"/><p class="title"><b>[예 7.5] 컬렉션 타입의 외부 조인 Select</b></p><div class="example-contents">
        

        

        <pre class="programlisting">SQL&gt; SELECT id, d.* FROM coll_tbl c, TABLE(c.coll_val)(+) d; 

        ID COLUMN_VALUE
---------- ------------
         1 AB
         1 CD
         2 EF
         2 GH
         3 

5 rows selected.</pre>
      </div></div><br class="example-break"/>

      <p>외부 조인을 수행하지 않았을 경우에는 빈 컬렉션에 해당하는 로우가 Select되지 않지만, 외부 조인을 수행하였을
      경우에는 빈 컬렉션에 해당하는 로우도 출력되는 것을 볼 수가 있다.</p>

      <div class="literallayout"><p/></div>

      <p>서브 쿼리의 결과가 하나의 컬렉션 값을 반환하는 스칼라 서브 쿼리일 경우 이 서브 쿼리를 TABLE() 표현식의 인자로
      주어서 컬렉션 내용을 풀어헤쳐 조회해 볼 수 있다. 즉, 서브 쿼리는 일반적인 값 표현식에 올 수 있는 스칼라 서브 쿼리만
      허용된다.</p>

      <div class="example"><a id="d5e3006"/><p class="title"><b>[예 7.6] 서브 쿼리 결과가 컬렉션인 경우</b></p><div class="example-contents">
        

        

        <pre class="programlisting">SQL&gt; SELECT * FROM TABLE(SELECT coll_val FROM coll_tbl WHERE id = 1);

COLUMN_VALUE
------------
AB
CD

2 rows selected.</pre>
      </div></div><br class="example-break"/>

      <p>위 예제의 서브쿼리에서 WHERE 절이 존재하지 않고 서브쿼리의 결과 로우의 갯수가 2개 이상일 경우는, 위 TABLE
      쿼리는 정상 수행되지 않고 런타임 에러를 발생시킨다.</p>

      <p/>

      <div class="literallayout"><p/></div>

      <p>다층 컬렉션의 경우 TABLE() 표현식을 반복해서 사용함으로써 다층 컬렉션의 임의의 계층에 들어있는 요소들도 추출이
      가능하다. 이 때 상위 계층의 TABLE() 표현식이 만들어 내는 컬렉션 컬럼을 그 다음 계층의 TABLE() 표현식에 명시하기
      위해서는 테이블 별칭이 필요하다.</p>

      <div class="example"><a id="d5e3013"/><p class="title"><b>[예 7.7] 다층 컬렉션</b></p><div class="example-contents">
        

        

        <pre class="programlisting">SQL&gt; SELECT id, z.* FROM nested_coll_tbl x, TABLE(x.coll_val) y,
                         TABLE(y.COLUMN_VALUE) z;

        ID COLUMN_VALUE
---------- ------------
         1 AB
         1 CD
         2 EF
         2 GH

4 rows selected.</pre>
      </div></div><br class="example-break"/>

      <p/>

      <div class="literallayout"><p/></div>

      <p>컬렉션이 객체에 대한 컬렉션일 경우 TABLE() 표현식이 반환하는 테이블은 객체 테이블이 되며 객체 테이블에서 구사할
      수 있는 각종 표현식을 똑같이 구사할 수 있다. 또한 이 테이블은 COLUMN_VALUE 컬럼을 가지지 않으며 객체 테이블의 기반
      객체 타입의 속성 이름과 같은 이름의 컬럼들을 가진다.</p>

      <div class="example"><a id="d5e3019"/><p class="title"><b>[예 7.8] 컬렉션이 객체에 대한 컬렉션</b></p><div class="example-contents">
        

        

        <pre class="programlisting">CREATE TYPE customer_type2 AS OBJECT (
  custno NUMBER,
  name   VARCHAR2(40),
  phone  VARCHAR2(20),
  MEMBER FUNCTION tostring RETURN VARCHAR);
/

CREATE TYPE BODY customer_type2 AS
  MEMBER FUNCTION tostring RETURN VARCHAR IS
  BEGIN
    RETURN custno || ':' || name || ':' || phone;
  END;
END;
/

CREATE OR REPLACE TYPE cust_coll_type AS VARRAY(400) OF customer_type2;
/

CREATE TABLE cust_coll_tab (
  id NUMBER,
  coll_val cust_coll_type);

INSERT INTO cust_coll_tab VALUES (1,
  cust_coll_type(customer_type2(1, 'Bob', '222-333-4444'),
                 customer_type2(2, 'Alice', '444-555-6666')));

SQL&gt; SELECT id, d.*, VALUE(d).tostring() str FROM
       cust_coll_tab c, TABLE(c.coll_val) d;

        ID     CUSTNO NAME  PHONE        STR                           
---------- ---------- ----- ------------ ------------------------------
         1          1 Bob   222-333-4444 1:Bob:222-333-4444
         1          2 Alice 444-555-6666 2:Alice:444-555-6666

2 rows selected.</pre>
      </div></div><br class="example-break"/>

      <p/>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3024"/>7.2.2. DML에서 사용</h3></div></div></div>
      

      <p>현재 중첩 테이블에 대해서는 DML이 지원되지 않고 가변 배열에 대해서는 가변 배열값을 통으로 Insert하거나
      Update하는 것은 지원된다. 쿼리 내에서 가변 배열의 요소를 조작하는 것은 지원되지 않는다.</p>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chapter_object_type.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="appendix_a.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제6장 객체 타입의 사용 </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> Appendix A. <span>tbJDBC</span> 예제</td></tr></table></div><div xmlns="" align="center"/></body></html>