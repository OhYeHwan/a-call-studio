<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제19장 DBMS_LOCK</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero tbPSM 참조 안내서"/><link rel="up" href="index.html" title="Tibero tbPSM 참조 안내서"/><link rel="prev" href="chap_dbms_lob.html" title="제18장 DBMS_LOB"/><link rel="next" href="chap_dbms_metadata.html" title="제20장 DBMS_METADATA"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제19장 DBMS_LOCK</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap_dbms_lob.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="chap_dbms_metadata.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chap_dbms_lock"/>제19장 DBMS_LOCK</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chap_dbms_lock.html#d5e6859">19.1. 개요</a></span></dt><dt><span class="section"><a href="chap_dbms_lock.html#d5e6981">19.2. 프러시저</a></span></dt><dd><dl><dt><span class="section"><a href="chap_dbms_lock.html#DBMS_LOCK_ALLOCATE_UNIQUE">19.2.1. ALLOCATE_UNIQUE</a></span></dt><dt><span class="section"><a href="chap_dbms_lock.html#DBMS_LOCK_CONVERT">19.2.2. CONVERT</a></span></dt><dt><span class="section"><a href="chap_dbms_lock.html#DBMS_LOCK_RELEASE">19.2.3. RELEASE</a></span></dt><dt><span class="section"><a href="chap_dbms_lock.html#DBMS_LOCK_REQUEST">19.2.4. REQUEST</a></span></dt><dt><span class="section"><a href="chap_dbms_lock.html#DBMS_LOCK_SLEEP">19.2.5. SLEEP</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 DBMS_LOCK 패키지의 기본 개념과 패키지 내의 프러시저를 사용하는 방법을 설명한다.</p>

  <p/>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e6859"/>19.1. 개요<a id="d5e6861" class="indexterm"/></h2></div></div></div>
    

    <p><span><strong class="guibutton">DBMS_LOCK</strong></span>은 유저에게 Lock 관리 및 SLEEP 기능을 제공하는
    패키지이다. 이 패키지는 디폴트로 관리자만 수행 가능하다.</p>

    <p>DBMS_LOCK 패키지에서는 아래 테이블에 정의된 상수를 사용한다.</p>

    <div class="informaltable">
        <table border="1"><colgroup><col width="100" align="left"/><col width="350" align="left"/><col width="80" align="left"/><col/></colgroup><thead><tr><th align="left">이름</th><th align="left">별칭</th><th align="left">타입</th><th>값</th></tr></thead><tbody><tr><td align="left">NS_MODE</td><td align="left">Null</td><td align="left">INTEGER</td><td>1</td></tr><tr><td align="left">SS_MODE</td><td align="left">Sub shared</td><td align="left">INTEGER</td><td>2</td></tr><tr><td align="left">SX_MODE</td><td align="left">Sub eXclusive or Row Exclusive Mode</td><td align="left">INTEGER</td><td>3</td></tr><tr><td align="left">S_MODE</td><td align="left">Shared or Row Exclusive Mode or Intended
              Exclusive</td><td align="left">INTEGER</td><td>4</td></tr><tr><td align="left">SSX_MODE</td><td align="left">Shared Sub eXclusive or Shared Row Exclusive Mode</td><td align="left">INTEGER</td><td>5</td></tr><tr><td align="left">X_MODE</td><td align="left">Exclusive</td><td align="left">INTEGER</td><td>6</td></tr></tbody></table>
      </div><p>다른 스레드에서 lock을 잡고 있는 경우, 아래 호환성 표에 따라 요청 결과가
    결정된다.</p>

    <p/>

    <div class="informaltable">
      <table border="1"><colgroup><col width="100" align="left"/><col width="80" align="left"/><col width="80" align="left"/><col width="80" align="left"/><col width="80" align="left"/><col width="80" align="left"/><col/></colgroup><thead><tr><th align="left">모드</th><th align="left">NL 요청</th><th align="left">SS 요청</th><th align="left">SX 요청</th><th align="left">S 요청</th><th align="left">SSX 요청</th><th>X 요청</th></tr></thead><tbody><tr><td align="left">NL</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td>성공</td></tr><tr><td align="left">SS</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td>실패</td></tr><tr><td align="left">SX</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td align="left">성공</td><td align="left">실패</td><td>실패</td></tr><tr><td align="left">S</td><td align="left">성공</td><td align="left">성공</td><td align="left">실패</td><td align="left">성공</td><td align="left">실패</td><td>실패</td></tr><tr><td align="left">SSX</td><td align="left">성공</td><td align="left">성공</td><td align="left">실패</td><td align="left">실패</td><td align="left">실패</td><td>실패</td></tr><tr><td align="left">X</td><td align="left">성공</td><td align="left">실패</td><td align="left">실패</td><td align="left">실패</td><td align="left">실패</td><td>실패</td></tr></tbody></table>
    </div>

    <p>상수 MAXWAIT으로 설정할 경우 영원히 기다린다.</p>

    <pre class="programlisting">maxwait constant pls_integer := 32767; </pre>

    <p/>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e6981"/>19.2. 프러시저</h2></div></div></div>
    

    <p>본 절에서는 DBMS_LOCK 패키지에서 제공하는 프러시저를 알파벳 순으로 설명한다.</p>

    <p/>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_LOCK_ALLOCATE_UNIQUE"/>19.2.1. ALLOCATE_UNIQUE<a id="d5e6987" class="indexterm"/></h3></div></div></div>
      

      <p>지정된 lockname에 Lock ID를 할당하는 프러시저이다. Lock ID 값의 범위는 1073741824 에서
      1999999999까지이다. 사용자에게 숫자가 아닌 이름을 통해서 관리를 쉽게하기 위한 목적으로 제공한다.</p>

      <div class="literallayout"><p/></div>

      <p>ALLOCATE_UNIQUE 프러시저의 세부 내용은 다음과 같다.<a id="d5e6993" class="indexterm"/></p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_LOCK.ALLOCATE_UNIQUE
(
    lockname            IN          VARCHAR2,                                                      
    lockhandle          OUT         VARCHAR2,                                                      
    expiration_secs     IN          PLS_INTEGER     DEFAULT 864000
)</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">lockname</td><td>유일한 lockhandle 값을 생성할 Lock 이름을 지정한다.</td></tr><tr><td align="left">lockhandle</td><td><p>생성된 Lock ID에 대한 handle을 리턴받는다. 이 handle 값을 통해
                  REQEST, CONVERT, RELEASE 프러시저를 호출할 수 있다. </p><p>Lock
                  ID를 잘못 사용했을 때의 문제를 방지하기 위해 Lock ID를 직접 리턴하는 대신 VARCHAR2
                  (128) 변수로 설정된 handle 값을 리턴한다. handle은 한 세션에서만 유효하므로 다른 세션에서
                  해당 값을 사용해서는 안 된다.</p></td></tr><tr><td align="left">expiration_secs</td><td><p>DBMS_LOCK_ALLOCATED 테이블을 재활용하기 위한 유효 시간을 초단위로
                  지정한 값이다. (기본값: 10일)</p><p>마지막 ALLOCATE_UNIQUE 프러시저를
                  호출한 시점이후로 지나간 시간을
                  계산한다.</p><p><span><strong class="guibutton">DBMS_LOCK_ALLOCATED 테이블에서 Lock을
                  직접 삭제해서는 안 된다. _DBMS_LOCK_REUSE 초기화 파라미터를 Y로 설정한 경우에만
                  동작한다.</strong></span></p></td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">DECLARE
    lock_handle VARCHAR2(128);
BEGIN
    DBMS_LOCK.ALLOCATE_UNIQUE('my_lock', lock_handle);
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_LOCK_CONVERT"/>19.2.2. CONVERT<a id="d5e7029" class="indexterm"/></h3></div></div></div>
      

      <p>기존 Lock 모드에서 다른 Lock 모드로 변경하기 위한 프러시저이다.</p>

      <div class="literallayout"><p/></div>

      <p>CONVERT 프러시저의 세부 내용은 다음과 같다.<a id="d5e7035" class="indexterm"/></p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_LOCK.CONVERT
(
    id         IN INTEGER || 
    lockhandle IN VARCHAR2,
    lockmode   IN INTEGER,
    timeout    IN NUMBER DEFAULT MAXWAIT
) 
RETURN INTEGER;</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">id or lockhandle</td><td>Lock 모드를 변경하기 위한 Lock ID 또는 handle이다.</td></tr><tr><td align="left">lockmode</td><td>변경할 새로운 Lock 모드이다.</td></tr><tr><td align="left">timeout</td><td><p>Lock 모드 변경을 위해 기다릴 시간을 설정한다. </p><p>만약
                  Lock을 얻을 수 없다면 timeout 에러 값을 리턴한다. (단위: 초)</p></td></tr></tbody></table>
          </div>
        </li><li>
          <p>반환값</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">반환값</th><th>설명</th></tr></thead><tbody><tr><td align="left">0</td><td>Success</td></tr><tr><td align="left">1</td><td>Timeout</td></tr><tr><td align="left">2</td><td>Deadlock</td></tr><tr><td align="left">3</td><td>Parameter error</td></tr><tr><td align="left">4</td><td>Owner error</td></tr><tr><td align="left">5</td><td>Illegal lock handle</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">BEGIN
    DBMS_LOCK.CONVERT(lock_handle, DBMS_LOCK.X_MODE, 600);
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_LOCK_RELEASE"/>19.2.3. RELEASE<a id="d5e7095" class="indexterm"/></h3></div></div></div>
      

      <p>기존 잡았던 Lock을 명시적으로 해제하기 위한 프러시저이다. 기본적으로 Lock은 세션이 종료되면 자동적으로
      해제된다.</p>

      <div class="literallayout"><p/></div>

      <p>RELEASE 프러시저의 세부 내용은 다음과 같다.<a id="d5e7101" class="indexterm"/></p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_LOCK.RELEASE
(
    id         IN INTEGER || 
    lockhandle IN VARCHAR2
) 
RETURN INTEGER;</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">id or lockhandle</td><td>Lock을 해제하기 위한 Lock ID 또는 handle이다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>반환값</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">반환값</th><th>설명</th></tr></thead><tbody><tr><td align="left">0</td><td>Success</td></tr><tr><td align="left">3</td><td>Parameter error</td></tr><tr><td align="left">4</td><td>Owner error</td></tr><tr><td align="left">5</td><td>Illegal lock handle</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">BEGIN
    DBMS_LOCK.RELEASE(lock_handle);
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_LOCK_REQUEST"/>19.2.4. REQUEST<a id="d5e7147" class="indexterm"/></h3></div></div></div>
      

      <p>원하는 Lock 모드를 지정하여 Lock을 요청하기 위한 프러시저이다.</p>

      <div class="literallayout"><p/></div>

      <p>REQUEST 프러시저의 세부 내용은 다음과 같다.<a id="d5e7153" class="indexterm"/></p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_LOCK.REQUEST
(
    id                 IN  INTEGER ||
    lockhandle         IN  VARCHAR2,
    lockmode           IN  INTEGER DEFAULT X_MODE,
    timeout            IN  INTEGER DEFAULT MAXWAIT,
    release_on_commit  IN  BOOLEAN DEFAULT FALSE
) 
RETURN INTEGER;</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">id or lockhandle</td><td>Lock을 요청하기 위한 Lock ID 또는 handle이다.</td></tr><tr><td align="left">lockmode</td><td>요청하는 Lock 모드이다.</td></tr><tr><td align="left">timeout</td><td><p>Lock 얻기 위해 기다릴 시간이다. (단위: 초) </p><p>만약
                  Lock을 얻을 수 없다면 timeout 에러 값을 리턴한다.</p></td></tr><tr><td align="left">release_on_commit</td><td><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                        <p>TRUE : commit이나 rollback할 때 Lock이 해제된다.</p>
                      </li><li style="list-style-type: circle">
                        <p>FALSE : 명시적으로 Lock을 해제하거나 세션이 종료될 때까지 Lock을 해제하지
                        않는다.</p>
                      </li></ul></div></td></tr></tbody></table>
          </div>
        </li><li>
          <p>반환값</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">반환값</th><th>설명</th></tr></thead><tbody><tr><td align="left">0</td><td>Success</td></tr><tr><td align="left">1</td><td>Timeout</td></tr><tr><td align="left">2</td><td>Deadlock</td></tr><tr><td align="left">3</td><td>Parameter error</td></tr><tr><td align="left">4</td><td>Already owned by id or lockhandle</td></tr><tr><td align="left">5</td><td>Illegal lock handle</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">BEGIN
    DBMS_LOCK.REQUEST(lock_handle, DBMS_LOCK.S_MODE, DBMS_LOCK.MAXWAIT, TRUE);
END;
/</pre>
        </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="DBMS_LOCK_SLEEP"/>19.2.5. SLEEP<a id="d5e7221" class="indexterm"/></h3></div></div></div>
      

      <p>현재 세션을 일정 시간만큼 대기시킨다.</p>

      <div class="literallayout"><p/></div>

      <p>SLEEP 프러시저의 세부 내용은 다음과 같다.<a id="d5e7227" class="indexterm"/></p>

      <div class="itemizedlist"><ul type="disc" compact="compact"><li>
          <p>프로토타입</p>

          <pre class="programlisting">DBMS_LOCK.SLEEP
(
    seconds        IN         NUMBER
)</pre>
        </li><li>
          <p>파라미터</p>

          <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">seconds</td><td>대기 시간(초)이다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p>예제</p>

          <pre class="programlisting">DECLARE
   second NUMBER;
BEGIN
   second := 0.11;
   DBMS_LOCK.SLEEP(second);
END;
/</pre>
        </li></ul></div>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap_dbms_lob.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="chap_dbms_metadata.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제18장 DBMS_LOB </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제20장 DBMS_METADATA</td></tr></table></div><div xmlns="" align="center"/></body></html>