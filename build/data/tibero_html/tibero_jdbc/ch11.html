<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제11장 사용자 정의 데이터 타입</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero JDBC 개발자 안내서"/><link rel="up" href="index.html" title="Tibero JDBC 개발자 안내서"/><link rel="prev" href="ch10.html" title="제10장 SSL"/><link rel="next" href="idx.html" title="색인"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제11장 사용자 정의 데이터 타입</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch10.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="idx.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="d5e3271"/>제11장 사용자 정의 데이터 타입</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="ch11.html#d5e3275">11.1. 개요</a></span></dt><dt><span class="section"><a href="ch11.html#d5e3283">11.2. Array 타입 </a></span></dt><dd><dl><dt><span class="section"><a href="ch11.html#d5e3292">11.2.1. Array 데이터 타입 선언</a></span></dt><dt><span class="section"><a href="ch11.html#d5e3298">11.2.2. Array 데이터 타입 IN</a></span></dt><dt><span class="section"><a href="ch11.html#d5e3318">11.2.3. Array 데이터 타입 OUT</a></span></dt></dl></dd><dt><span class="section"><a href="ch11.html#d5e3337">11.3. Struct 타입 </a></span></dt><dd><dl><dt><span class="section"><a href="ch11.html#d5e3347">11.3.1. Struct 데이터 타입 선언</a></span></dt><dt><span class="section"><a href="ch11.html#d5e3353">11.3.2. Struct 데이터 타입 IN</a></span></dt><dt><span class="section"><a href="ch11.html#d5e3371">11.3.3. Struct 데이터 타입 OUT</a></span></dt></dl></dd><dt><span class="section"><a href="ch11.html#d5e3388">11.4. Array, Struct 타입 테스트 코드</a></span></dt></dl></div>
  

  <p>본 장에서는 <span>tbJDBC</span>에서 사용자 정의 데이터 타입을 처리하는 방법을 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e3275"/>11.1. 개요</h2></div></div></div>
    

    <p>JDBC 표준에서는 사용자 정의 데이터 타입(User Defined Types) 지원을 위해서 java.sql.Array,
    java.sql.Struct 인터페이스를 제공하고 있다.</p>

    <div class="itemizedlist"><ul type="disc" compact="compact"><li>
        <p>Array 타입은 동일한 타입의 원소들을 모아서 저장하기 위한 타입이다.</p>
      </li><li>
        <p>Struct 타입은 여러 가지 타입의 원소들을 저장하기 위한 타입이다.</p>
      </li></ul></div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e3283"/>11.2. Array 타입 <a id="d5e3285" class="indexterm"/></h2></div></div></div>
    

    <p><span>tbJDBC</span>는 java.sql.Array 인터페이스를 구현한 com.<span>tmax.tibero</span>.jdbc.<span>Tb</span>Array
    클래스를 제공한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3292"/>11.2.1. Array 데이터 타입 선언<a id="d5e3294" class="indexterm"/></h3></div></div></div>
      

      <p>사용자는 다음 같이 Array 타입을 정의할 수 있다.</p>

      <pre class="programlisting">create or replace type t_varr      is varray(16) of varchar2(128);

create or replace type t_tbl       is table      of varchar2(128);
</pre>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3298"/>11.2.2. Array 데이터 타입 IN<a id="d5e3300" class="indexterm"/></h3></div></div></div>
      

      <p>Array를 객체를 만들고 PSM 프러시저의 IN 인자로 전달하기 위해서 다음의 과정으로 처리한다.</p>

      <div class="orderedlist"><ol type="1" compact="compact"><li>
          <p>Connection 객체로부터 Array를 생성한다.</p>

          <pre class="programlisting">public Array Connection.createArrayOf(String typeName, Object[] elements)
throws SQLException;</pre>
        </li><li>
          <p>프러시저에 Array 객체를 바인딩한다.</p>

          <p>CallabaleStatement의 setObject()를 통해서 Array 객체를 PSM 프러시저에 넘길 수
          있다.</p>
        </li></ol></div>

      <p/>

      <p/>

      <div class="literallayout"><p/></div>

      <p>다음은 Array를 객체를 만들고 PSM 프러시저의 IN 인자로 전달하는 예제이다.</p>

      <pre class="programlisting">StringBuffer sbProc = new StringBuffer();

sbProc.append("begin ");
sbProc.append("    print_varr(?); ");
sbProc.append("end; ");

Object[] attributes = new Object[16];
for (int i = 0; i &lt; 16; i++) {
     	attributes[i] = "abc" + i;
}


Array arr = conn.createArrayOf("<span>TIBERO</span>.T_VARR", attributes);

CallableStatement cstmt = conn.prepareCall(sbProc.toString());

cstmt.setObject(1, arr);
cstmt.execute();

int status = 0;
int i = 0;
while (status == 0) {
     	cstmt = conn.prepareCall("{call sys.dbms_output.get_line(?, ?)}");
     	cstmt.registerOutParameter(1, java.sql.Types.VARCHAR);
     	cstmt.registerOutParameter(2, java.sql.Types.NUMERIC);
     	cstmt.execute();

     	status = cstmt.getInt(2);
     	if (status != 0)
     	     	break;
     	String retStr = cstmt.getString(1);
     	String ret[] = retStr.split(":");
     	System.out.println(ret[1]);
}
</pre>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3318"/>11.2.3. Array 데이터 타입 OUT<a id="d5e3320" class="indexterm"/></h3></div></div></div>
      

      <p>프러시저로부터 OUT 인자 형태로 Array 객체를 받아오기 위해서는 다음의 단계로 처리한다.</p>

      <div class="orderedlist"><ol type="1" compact="compact"><li>
          <p>OUT 바인딩을 통한 프러시저를 호출하면 프러시저는 Array 타입 객체를 돌려준다.</p>
        </li><li>
          <p>CallableStatement.getArray() 함수를 통해 Array 객체를 받아온다.</p>
        </li><li>
          <p>Array 객체로부터 값을 받아온다.</p>
        </li></ol></div>

      <p/>

      <div class="literallayout"><p/></div>

      <p>다음은 프러시저로부터 OUT 인자 형태로 Array 객체를 받아오는 예제이다. p_out_t_varr 프러시저는
      16개의 문자열 배열을 돌려주도록 작성되어 있다.</p>

      <pre class="programlisting">sbProc.append("begin ");
sbProc.append("    p_out_t_varr(?, ?); ");
sbProc.append("end; ");

CallableStatement cstmt = conn.prepareCall(sbProc.toString());
cstmt.registerOutParameter(1, Types.ARRAY, "<span>TIBERO</span>.T_VARR");
cstmt.setString(2, "abc");
cstmt.execute();

<span>Tb</span>Array arr = (<span>Tb</span>Array) cstmt.getArray(1);

Object obj = arr.getArray();

String[] bdArr = (String[]) obj;
assertEquals(16, bdArr.length);
for (int i = 0; i &lt; bdArr.length; i++) {
    System.out.println(bdArr[i]);
}
</pre>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e3337"/>11.3. Struct 타입 <a id="d5e3339" class="indexterm"/></h2></div></div></div>
    

    <p>build-in 타입의 collection을 처리하는 Array와 달리 Struct는 여러 종류의 타입을 묶어서 나타내는
    경우 사용한다. <span>tbJDBC</span>는 java.sql.Struct 인터페이스를 구현한 com.<span>tmax.tibero</span>.jdbc.<span>Tb</span> Struct
    클래스를 제공한다.</p>

    <p/>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3347"/>11.3.1. Struct 데이터 타입 선언<a id="d5e3349" class="indexterm"/></h3></div></div></div>
      

      <p>다음과 같이 Struct 타입을 선언할 수 있다.</p>

      <pre class="programlisting">create or replace type t_obj is object (obj_id number, name varchar(128), d date);
</pre>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3353"/>11.3.2. Struct 데이터 타입 IN<a id="d5e3355" class="indexterm"/></h3></div></div></div>
      

      <p>Struct 객체를 IN 인자로 전달하기 위해서는 다음의 단계로 처리한다.</p>

      <div class="orderedlist"><ol type="1" compact="compact"><li>
          <p>Connection 객체로부터 Struct를 생성한다.</p>

          <pre class="programlisting">public Struct Connection.createStruct(String typeName, Object[] attributes)</pre>
        </li><li>
          <p>프러시저에 Struct 객체를 바인딩한다.</p>

          <p>CallabaleStatement의 setObject()를 통해서 Struct 객체를 PSM 프러시저에 넘길 수
          있다.</p>
        </li></ol></div>

      <p/>

      <p>다음은 Struct 객체를 IN 인자로 전달하는 예제이다. print_obj 프러시저는 Struct 객체를 인자로
      받아서 처리하는 기능을 담당한다.</p>

      <pre class="programlisting">StringBuffer sbProc = new StringBuffer();

sbProc.append("begin ");
sbProc.append("    print_obj(?); ");
sbProc.append("end; ");

Object[] attributes = new Object[3];
attributes[0] = 1;
attributes[1] = "abc1";
Calendar cal = Calendar.getInstance();
cal.set(2012, 11, 21); // 2012. 12. 21
attributes[2] = new Date(cal.getTimeInMillis());

<span>Tb</span>Struct struct = conn.createStruct("<span>TIBERO</span>.T_OBJ", attributes);

CallableStatement cstmt = conn.prepareCall(sbProc.toString());
cstmt.setObject(1, struct);
int row = cstmt.executeUpdate();
</pre>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e3371"/>11.3.3. Struct 데이터 타입 OUT<a id="d5e3373" class="indexterm"/></h3></div></div></div>
      

      <p>프러시저로부터 Struct 객체를 OUT 인자 형태로 받아오기 위해서는 다음의 단계로 처리하면 된다.</p>

      <div class="orderedlist"><ol type="1" compact="compact"><li>
          <p>OUT 바인딩을 통한 프러시저를 호출한다. 프러시저는 Struct 타입의 객체를 돌려준다.</p>
        </li><li>
          <p>CallableStatement.getStruct() 함수를 통해 Struct 객체를 받아온다.</p>
        </li><li>
          <p>Struct 객체로부터 값을 받아온다.</p>
        </li></ol></div>

      <p/>

      <p>다음은 프러시저로부터 Struct 객체를 OUT 인자형태로 받아오는 예제이다. p_out_t_obj 프러시저는
      NUMBER, VARCHAR, DATE 형태의 object 객체를 돌려준다.</p>

      <pre class="programlisting">StringBuffer sbProc = new StringBuffer();
        
sbProc.append("begin ");
sbProc.append("    p_out_t_obj(?); ");
sbProc.append("end; ");

CallableStatement cstmt = conn.prepareCall(sbProc.toString());
cstmt.registerOutParameter(1, Types.STRUCT, "<span>TIBERO</span>.T_OBJ");
cstmt.execute();

Struct struct = (Struct) cstmt.getObject(1);
Object[] structArr = struct.getAttributes();

System.out.println(structArr.length);

System.out.println("number : " + structArr[0]);
System.out.println("varchar : " + structArr[1]);
System.out.println("date : " + structArr[2]);
</pre>

      <p/>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e3388"/>11.4. Array, Struct 타입 테스트 코드</h2></div></div></div>
    

    <p>다음은 위의 Array, Struct 타입 생성 및 테스트를 위한 프러시저 코드이다.</p>

    <pre class="programlisting">create or replace type t_obj is object (obj_id number, name varchar(128), d date);
/
create or replace type t_varr is varray(16) of varchar2(128);
/
create or replace type t_varr_varr is varray(8) of t_varr;
/
create or replace type t_tbl is table of varchar2(128);
/
create or replace type t_tbl_tbl is table of t_tbl;
/
create or replace type t_varr_obj is varray(4) of t_obj;
/
create or replace type t_tbl_obj is table of t_obj;
/
create or replace procedure p_out_t_obj(o out t_obj)
is
begin
    o := t_obj(1,'abc',to_date('1900-01-01', 'YYYY-MM-DD'));
end;
/
create or replace procedure p_out_t_varr(o out t_varr, str varchar2)
as
    o_val t_varr;
begin
    o_val := t_varr();

    for i in  1 .. 16 loop
        o_val.extend;
        o_val(i) :=  str || to_char(i);
    end loop;
    o := o_val;
end;
/
create or replace procedure p_out_t_varr_varr(o out t_varr_varr)
as
  o_val t_varr_varr;
begin
    o_val := t_varr_varr();

    for i in 1 .. 8 loop
        o_val.extend;
        p_out_t_varr(o_val(i),  'elem' || to_char(i));
    end loop;
    o := o_val;
end;
/
create or replace procedure p_out_t_tbl(o out t_tbl, str varchar2)
as
    o_val t_tbl;
begin
    o_val := t_tbl();

    for i in  1 .. 4 loop
        o_val.extend;
        o_val(i) :=  str || to_char(i);
    end loop;
    o := o_val;
end;
/
create or replace procedure p_out_t_tbl_tbl(o out t_tbl_tbl)
as
  o_val t_tbl_tbl;
begin
    o_val := t_tbl_tbl();

    for i in 1 .. 2 loop
        o_val.extend;
        p_out_t_tbl(o_val(i),  'elem' || to_char(i));
    end loop;
    o := o_val;
end;
/
create or replace procedure p_out_t_varr_obj(o out t_varr_obj)
as
  o_val t_varr_obj;
begin
    o_val := t_varr_obj();
    for i in 1 .. 4 loop
        o_val.extend;
        p_out_t_obj(o_val(i));
    end loop;
    o := o_val;
end;
/
create or replace procedure p_out_t_tbl_obj(o out t_tbl_obj)
as
  o_val t_tbl_obj;
begin
    o_val := t_tbl_obj();
    for i in 1 .. 6 loop
        o_val.extend;
        p_out_t_obj(o_val(i));
    end loop;
    o := o_val;
end;
/
create or replace procedure print_obj(p in t_obj)
as
begin
    dbms_output.put_line('obj_id:' || p.obj_id);
    dbms_output.put_line('name  :' || p.name);
    dbms_output.put_line('d     :' || p.d);
end;
/
create or replace procedure print_varr(p in t_varr)
as
begin
    for i in  1 .. 16 loop
        dbms_output.put_line(to_char(i) || ':' ||  p(i));
    end loop;
end;
/
create or replace procedure print_varr_varr(p in t_varr_varr)
as
begin
    for i in  1 .. 8 loop
        print_varr(p(i));
    end loop;
end;
/
create or replace procedure print_tbl(p in t_tbl)
as
begin
    for i in  1 .. 4 loop
        dbms_output.put_line(to_char(i) || ':' ||  p(i));
    end loop;
end;
/
create or replace procedure print_tbl_tbl(p in t_tbl_tbl)
as
begin
    for i in  1 .. 2 loop
        print_tbl(p(i));
    end loop;
end;
/
create or replace procedure print_varr_obj(p in t_varr_obj)
as
begin
    for i in 1 .. 4 loop
        print_obj(p(i));
    end loop;    
end;
/
create or replace procedure print_tbl_obj(p in t_tbl_obj)
as
begin
    for i in 1 .. 6 loop
        print_obj(p(i));
    end loop;
end;
/    </pre>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch10.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="idx.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제10장 SSL </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 색인</td></tr></table></div><div xmlns="" align="center"/></body></html>