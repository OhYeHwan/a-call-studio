<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제5장 멀티 스레드 프로그래밍</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Tibero tbESQL/C 안내서"/><link rel="up" href="index.html" title="Tibero tbESQL/C 안내서"/><link rel="prev" href="chapter_array_variable.html" title="제4장 배열 변수"/><link rel="next" href="chapter_dynamic_sql.html" title="제6장 Dynamic SQL"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제5장 멀티 스레드 프로그래밍</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chapter_array_variable.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="chapter_dynamic_sql.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chapter_multi_thread"/>제5장 멀티 스레드 프로그래밍</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chapter_multi_thread.html#d5e2510">5.1. 개요</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_multi_thread.html#d5e2544">5.1.1. 런타임 컨텍스트</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_multi_thread.html#d5e2556">5.2. 프리컴파일러 옵션과 <span>tbESQL</span>/C 문장</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_multi_thread.html#d5e2564">5.2.1. 프리컴파일러 옵션</a></span></dt><dt><span class="section"><a href="chapter_multi_thread.html#d5e2578">5.2.2. <span>tbESQL</span>/C 문장</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_multi_thread.html#d5e2624">5.3. 주의사항</a></span></dt><dt><span class="section"><a href="chapter_multi_thread.html#d5e2631">5.4. 사용 예제</a></span></dt></dl></div>
  

  <p>본 장에서는 <span>tbESQL</span>/C 환경에서 멀티 스레드 프로그램을 작성하는 방법을 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e2510"/>5.1. 개요</h2></div></div></div>
    

    <p><span>tbESQL</span>/C를 이용하여 <span><strong class="guibutton">멀티 스레드(Multi-Thread)
    프로그램</strong></span>을 작성할 수 있다. 멀티 스레드 프로그램에서는 스레드가 공유하는 리소스에 대해 <span><strong class="guibutton">상호
    배제(Mutual Exclusion)</strong></span>를 지키기 위한
    <span><strong class="guibutton">동기화(Synchronization)</strong></span> 기법이 중요하다. <a id="d5e2517" class="indexterm"/><a id="d5e2519" class="indexterm"/><a id="d5e2521" class="indexterm"/><a id="d5e2523" class="indexterm"/><a id="d5e2525" class="indexterm"/></p>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
      <p>상호 배제란 여러 개의 스레드가 공통의 리소스에 접근할 때 리소스가 잘못된 조작으로 훼손되는 것을 방지하기 위해, 한
      번에 하나의 스레드만 리소스에 접근하도록 제어하는 것을 말한다.</p>
    </div>

    <div class="literallayout"><p/></div>

    <p>만약 하나의 <span><strong class="guibutton">런타임 컨텍스트(Runtime Context)</strong></span>를 동시에 여러 스레드가
    접근할 경우 사용자가 <span><strong class="guibutton">뮤텍스(Mutex)</strong></span> 등을 이용하여 동시 접근을 막아야
    한다.<a id="d5e2533" class="indexterm"/><a id="d5e2535" class="indexterm"/><a id="d5e2537" class="indexterm"/><a id="d5e2539" class="indexterm"/></p>

    <p>뮤텍스는 공통의 리소스에 동시에 여러 스레드가 접근하는 것이 아닌, 한 스레드만 접근할 필요가 있을 때 사용한다. 해당
    리소스에 대한 뮤텍스 객체를 생성하고, 뮤텍스 객체가 비신호 상태이면 현재 스레드가 리소스를 사용한 후 이를 반환하고, 뮤텍스 객체가
    신호 상태이면, 현재 스레드를 대기 상태로 만든다.</p>

    <p><span>tbESQL</span>/C에서는 런타임 컨텍스트를 각 스레드마다 할당해 스레드 간에 상호 배제를
    보장할 수 있도록 한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2544"/>5.1.1. 런타임 컨텍스트</h3></div></div></div>
      

      <p><span>tbESQL</span>/C에서는 실행 중인 애플리케이션의 접속 정보와 세션(Session)
      정보, 커서 정보 등을 저장하기 위하여 <span><strong class="guibutton">런타임 컨텍스트</strong></span>를 제공한다.<a id="d5e2549" class="indexterm"/><a id="d5e2551" class="indexterm"/></p>

      <p>싱글 스레드(Single-Thread) 기반의 <span>tbESQL</span>/C 프로그램에서는 사용자가 할당하지 않아도 디폴트로 설정된 런타임
      컨텍스트가 사용된다. 멀티 스레드 프로그램의 경우 직접 런타임 컨텍스트를 할당하여 각 스레드마다 자신이 사용할 런타임 컨텍스트를
      선택할 수 있고, 스레드 간에 런타임 컨텍스트 정보의 전달이 가능하다.</p>

      <p>사용자는 하나의 런타임 컨텍스트를 공유하는 멀티 스레드 프로그램을 작성할 수 있으나, 이 경우 런타임 컨텍스트에 접근할
      때 뮤텍스 등을 이용하여 동시 접근을 막아야 한다. 그렇게 하지 않으려면 각 스레드마다 런타임 컨텍스트를 할당해 주면
      된다.</p>
    </div>

    
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e2556"/>5.2. 프리컴파일러 옵션과 <span>tbESQL</span>/C 문장</h2></div></div></div>
    

    <p><span>tbESQL</span>/C에서는 멀티 스레드와 관련하여 <span><strong class="guibutton">프리컴파일러
    옵션</strong></span>과 <span><strong class="guibutton"><span>tbESQL</span>/C 문장</strong></span>을 제공한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2564"/>5.2.1. 프리컴파일러 옵션<a id="d5e2566" class="indexterm"/></h3></div></div></div>
      

      <p>스레드와 관련된 프리컴파일러 옵션에는 THREADS가 있다.<a id="d5e2569" class="indexterm"/></p>

      <p>멀티 스레드 프로그램을 작성하기 위해서는 프리컴파일할 때 THREADS 옵션을
      <span><strong class="guibutton">'YES'</strong></span>로 설정해야 한다. 만약 THREADS 옵션을
      <span><strong class="guibutton">'NO'</strong></span>로 설정하고, 멀티 스레드와 관련된 <span>tbESQL</span>/C 문장을 가진 소스 코드를 프리컴파일할 경우 에러가
      발생한다.</p>

      <p>또한 <span>tbESQL</span>/C가 사용하는 <span>tbCLI</span>
      라이브러리의 경우 THREADS 옵션을 YES로 설정해야 컨텍스트 관련 문장을 사용할 수 있으며 스레드 사용과 관련된 리소스가
      안전한 상태로 라이브러리를 수행한다.</p>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d5e2578"/>5.2.2. <span>tbESQL</span>/C 문장</h3></div></div></div>
      

      <p>스레드와 관련된 <span>tbESQL</span>/C 문장을 설명하기 전에,
      <span><strong class="guibutton">ctx_var</strong></span>에 대해 설명하면, ctx_var는 <span>tbESQL</span>에서 제공하는 <span><strong class="guibutton">sql_context
      타입</strong></span>의 호스트 변수이다. 이 변수는 해당 런타임 컨텍스트를 가리킨다.</p>

      <p>ctx_var는 다음과 같이 선언한다.</p>

      <pre class="programlisting">sql_context ctx_var;</pre>

      <div class="literallayout"><p/></div>

      <p>스레드와 관련된 <span>tbESQL</span>/C 문장은 다음과 같다.</p>

      <div class="literallayout"><p/></div>

      <h4><a id="d5e2592"/>ENABLE THREADS<a id="d5e2593" class="indexterm"/></h4>

      <p>ENABLE THREADS 문장이 명시된 후부터 실행되는 <span>tbESQL</span>/C 문장은 멀티 스레드 환경에서 실행된다는 것을 의미한다. 스레드와
      관련된 모든 <span>tbESQL</span>/C 문장은 이 문장이 명시된 후에 사용할 수 있다.</p>

      <p>다음은 ENABLE THREADS 문장을 사용하는 예이다.</p>

      <pre class="programlisting">EXEC SQL ENABLE THREADS;</pre>

      <div class="literallayout"><p/></div>

      <h4><a id="d5e2601"/>CONTEXT ALLOCATE<a id="d5e2602" class="indexterm"/></h4>

      <p>sql_context 타입의 ctx_var 호스트 변수에 런타임 컨텍스트를 할당한다. 할당된 ctx_var는
      CONTEXT USE, CONTEXT FREE에 사용될 수 있다.</p>

      <p>다음은 CONTEXT ALLOCATE 문장을 사용하는 예이다.</p>

      <pre class="programlisting">EXEC SQL CONTEXT ALLOCATE :ctx_var;</pre>

      <div class="literallayout"><p/></div>

      

      <h4><a id="d5e2608"/>CONTEXT USE<a id="d5e2609" class="indexterm"/></h4>

      <p>EXEC SQL CONTEXT USE 문장을 통해 이 문장 이후의 ESQL 문장에서 사용할 런타임 컨텍스트를 지정해 줄
      수 있다. 이 문장의 적용 범위는 EXEC SQL WHENEVER 문장과 마찬가지로 다음에 나올 EXEC SQL CONTEXT
      USE 문장 직전까지이다.</p>

      <p>ctx_var는 EXEC SQL CONTEXT ALLOCATE를 통해 런타임 컨텍스트를 할당 받은 변수이어야 하고,
      <span><strong class="guibutton">'DEFAULT'</strong></span>로 설정할 경우 디폴트로 설정된 런타임 컨텍스트를 사용하겠다는 의미이다.
      모든 <span>tbESQL</span>/C 애플리케이션은 실행될 때 디폴트 런타임 컨텍스트를 할당
      받는다.</p>

      <p>다음은 CONTEXT USE 문장을 사용하는 예이다.</p>

      <pre class="programlisting">EXEC SQL CONTEXT USE { :ctx_var | DEFAULT };</pre>

      <div class="literallayout"><p/></div>

      <h4><a id="d5e2618"/>CONTEXT FREE<a id="d5e2619" class="indexterm"/></h4>

      <p>sql_context 타입의 ctx_var 호스트 변수에 할당된 런타임 컨텍스트를 해제한다. ctx_var는 EXEC
      SQL CONTEXT ALLOCATE를 통해 런타임 컨텍스트가 할당된 변수여야 한다.</p>

      <p>다음은 CONTEXT FREE 문장을 사용하는 예이다.</p>

      <pre class="programlisting">EXEC SQL CONTEXT FREE :ctx_var;</pre>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e2624"/>5.3. 주의사항</h2></div></div></div>
    

    <p>멀티 스레드 프로그램을 작성할 경우 각각의 스레드가 공유하는 리소스에 대한 <span><strong class="guibutton">상호
    배제</strong></span>를 보장하는 것이 중요하다.</p>

    <p>sqlca, sqlda와 같이 전역(global)으로 선언된 변수의 경우 <span>tbESQL</span>/C 런타임 라이브러리(Runtime Library)에서는 상호 배제를
    보장하지 않는다. 그러므로 각 런타임 컨텍스트가 자기만의 변수를 처리할 수 있도록 다음과 같이 프로그램을 작성해야 한다.</p>

    <pre class="programlisting">sql_context ctx;
...
void do_update()
{
    struct sqlca sqlca;
    /* 지역(local) 변수로 선언하여 현재 스레드(런타임 컨텍스트)만의
       변수로 사용한다. */
...
    EXEC SQL CONTEXT USE :ctx;
    EXEC SQL UPDATE TEST SET COL1 = 'thread'
             WHERE COL2 = 2.5;
    if (sqlca.sqlcode &lt; 0) do_error();
}
...</pre>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d5e2631"/>5.4. 사용 예제</h2></div></div></div>
    

    <p>다음은 스레드 관련된 프리컴파일러 옵션과 <span>tbESQL</span>/C 문장을 사용하는 예이다.</p>

    <pre class="programlisting">sql_context ctx1;
sql_context ctx2;

EXEC SQL ENABLE THREADS;
EXEC SQL CONTEXT ALLOCATE :ctx1;
EXEC SQL CONTEXT ALLOCATE :ctx2;

EXEC SQL INSERT INTO TEST VALUES('test1');
                          /* 디폴트 런타임 컨텍스트에 적용된다. */

EXEC SQL CONTEXT USE :ctx1;
EXEC SQL INSERT INTO TEST VALUES('test2');
                          /* ctx1 런타임 컨텍스트에 적용된다. */

EXEC SQL CONTEXT USE :ctx2;
EXEC SQL INSERT INTO TEST VALUES('test3');
                          /* ctx2 런타임 컨텍스트에 적용된다. */

EXEC SQL COMMIT;
                          /* ctx2 런타임 컨텍스트를 커밋한다. */

EXEC SQL CONTEXT FREE :ctx1;
EXEC SQL CONTEXT FREE :ctx2;</pre>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chapter_array_variable.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="chapter_dynamic_sql.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제4장 배열 변수 </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제6장 Dynamic SQL</td></tr></table></div><div xmlns="" align="center"/></body></html>